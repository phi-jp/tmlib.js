<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * userinterface.js
 */

tm.ui = tm.ui || {};


(function() {

<span id='tm-ui-Gauge'>	/**
</span>	 * @class tm.ui.Gauge
	 * ゲーム用ゲージクラス
     * @extends tm.display.RectangleShape
	 */
	tm.ui.Gauge = tm.createClass({
<span id='tm-ui-Gauge-method-constructor'>        superClass: tm.display.RectangleShape,
</span>
        /**
         * @constructor
         * コンストラクタ
         */
        init: function(width, height, color, direction) {
            this.superInit(width, height, {
                fillStyle: color || &quot;red&quot;,
                strokeStyle: &quot;rgba(255, 255, 255, 0)&quot;
            });

<span id='tm-ui-Gauge-property-isFull'>            this._reset(direction);
</span>        },

        /**
         * @property
         * @TODO ?
         */
        isFull: function() {
<span id='tm-ui-Gauge-property-isEmpty'>            return this.targetProp === this._maxValue;
</span>        },

        /**
         * @property
         * @TODO ?
         */
        isEmpty: function() {
<span id='tm-ui-Gauge-property-_reset'>            return this.targetProp == 0;
</span>        },

        /**
         * @property
         * @TODO ?
         * @private
         */
        _reset: function(direction) {
            this.direction = direction || &quot;left&quot;;
            switch (this.direction) {
                case &quot;left&quot;:
                    this.originX = 0;
                    this._targetPropName = &quot;width&quot;;
                    this._value     = this.width;
                    this._value = this._maxValue = this.width;
                    break;
                case &quot;right&quot;:
                    this.originX = 1;
                    this._targetPropName = &quot;width&quot;;
                    this._value = this._maxValue = this.width;
                    break;
                case &quot;up&quot;:
                    this.originY = 1;
                    this._targetPropName = &quot;height&quot;;
                    this._value     = this.height;
                    this._value = this._maxValue = this.height;
                    break;
                case &quot;down&quot;:
                    this.originY = 0;
                    this._targetPropName = &quot;height&quot;;
                    this._value     = this.height;
                    this._value = this._maxValue = this.height;
                    break;
<span id='tm-ui-Gauge-property-setValue'>            }
</span>        },

        /**
         * @property
         * @TODO ?
         */
        setValue: function(value, anim) {
        	value= Math.clamp(value, 0, this._maxValue);
            anim = (anim !== undefined) ? anim : true;

            this._value = value;
            this._targetValue = (value/this._maxValue)*this._maxValue;

            if (this._targetValue == this.targetProp) return ;

            this.tweener.clear();
            if (anim) {
                var props = {};
                props[this._targetPropName] = this._targetValue;
                this.tweener.to(props, Math.abs(this._targetValue-this.targetProp)*10);
                /*
                this.animation.addTween({
                    prop: this._targetPropName,
                    begin: this.targetProp,
                    finish: this._targetValue,
                    duration: Math.abs(this._targetValue-this.targetProp)*10,
                });
*/
            }
            else {
                this.targetProp = this._targetValue;
            }

<span id='tm-ui-Gauge-property-getValue'>            return this;
</span>        },

        /**
         * @property
         * @TODO ?
         */
        getValue: function() {
<span id='tm-ui-Gauge-property-setPercent'>            return this.value;
</span>        },

        /**
         * @property
         * @TODO ?
         */
        setPercent: function(percent, anim) {
<span id='tm-ui-Gauge-property-getPercent'>            this.setValue(this._maxValue*percent*0.01, anim);
</span>        },

        /**
         * @property
         * @TODO ?
         */
        getPercent: function() {
<span id='tm-ui-Gauge-property-setRatio'>            return (this._value/this._maxValue)*100;
</span>        },

        /**
         * @property
         * @TODO ?
         */
        setRatio: function(ratio) {
<span id='tm-ui-Gauge-property-getRatio'>            this.setValue(this._maxValue*percent, anim);
</span>        },

        /**
         * @property
         * @TODO ?
         */
        getRatio: function() {
<span id='tm-ui-Gauge-property-value'>            return this._value/this._maxValue;
</span>        },
    });
    
    /**
     * @property    value
     * 値
     */
    tm.ui.Gauge.prototype.accessor(&quot;value&quot;, {
        get: function() {
            return this._value;
        },
        set: function(v) {
<span id='tm-ui-Gauge-property-percent'>            this.setValue(v);
</span>        },
    });

    /**
     * @property    percent
     * パーセント
     */
    tm.ui.Gauge.prototype.accessor(&quot;percent&quot;, {
        get: function() {
            return this.getPercent();
        },
        set: function(v) {
<span id='tm-ui-Gauge-property-ratio'>            this.setPercent(v);
</span>        },
    });
    
    
    /**
     * @property    ratio
     * 比率
     */
    tm.ui.Gauge.prototype.accessor(&quot;ratio&quot;, {
        get: function() {
            return this.getRatio();
        },
        set: function(v) {
<span id='tm-ui-Gauge-property-targetProp'>            this.setRatio(v);
</span>        },
    });
    
    /**
     * @property    targetProp
     * ターゲット
     */
    tm.ui.Gauge.prototype.accessor(&quot;targetProp&quot;, {
        get: function() {
            return this[this._targetPropName];
        },
        set: function(v) {
<span id='tm-ui-Pad'>            this[this._targetPropName] = v;
</span>        },
    });
    
})();



(function() {
    
    /**
     * @class tm.ui.Pad
     * padクラス
     * @extends tm.display.Shape
     */
    tm.ui.Pad = tm.createClass({
        superClass: tm.display.Shape,
<span id='tm-ui-Pad-method-constructor'>        
</span>        isTouching: false,
        circle: null,

        /**
         * @constructor
         * コンストラクタ
         */
        init: function() {
            this.superInit(120, 120);
            
            var c = this.canvas;
            c.fillStyle = &quot;#fff&quot;;
            c.fillCircle(60, 60, 60);
            c.fillStyle = &quot;#eee&quot;;
            
            this._createCircle();
            
<span id='tm-ui-Pad-property-_createCircle'>            this.setInteractive(true);
</span>            
            this.alpha = 0.75;
        },

        /**
         * @property
         * @TODO ?
         * @private
         */
        _createCircle: function() {
            var circle = this.circle = tm.display.Shape(80, 80);
            this.addChild(circle);
            
            var c = circle.canvas;
            c.fillStyle = &quot;#222&quot;;
<span id='tm-ui-Pad-property-onpointingstart'>            c.setShadow(&quot;black&quot;, 2, 2, 2);
</span>            c.fillCircle(40, 40, 35);
        },

        /**
         * @property
         * @TODO ?
         */
<span id='tm-ui-Pad-property-onpointingend'>        onpointingstart: function() {
</span>            this.isTouching = true;
        },

        /**
         * @property
         * @TODO ?
         */
        onpointingend: function() {
<span id='tm-ui-Pad-property-onpointingmove'>            this.isTouching = false;
</span>            this.circle.position.set(0, 0);
        },

        /**
         * @property
         * @TODO ?
         */
        onpointingmove: function(e) {
            if (this.isTouching==false) return ;
            var p = e.pointing;
            var v = tm.geom.Vector2(p.x - this.x, p.y - this.y);
            var len = v.length();
            v.div(len);
            if (len &gt; 40) len = 40;
            
            this.angle = Math.radToDeg(v.toAngle());
            this.circle.position.set(v.x*len, v.y*len);
            
            // 大きさ
            this.distance  = len/40.0;
            // 向きベクトル
            this.direction = v.mul(this.distance);
        }
        
        
    });
    
})();



</pre>
</body>
</html>
