(function(){"use strict"})();var tm=tm||{};(function(){tm.VERSION="0.1.1",tm.LIB_ROOT=function(){if(!window.document)return;var a=document.getElementsByTagName("script");for(var b=0,c=a.length;b<c;++b);}(),tm.BROWSER=function(){if(!window.navigator)return;return/chrome/i.test(navigator.userAgent)?"Chrome":/safari/i.test(navigator.userAgent)?"Safari":/firefox/i.test(navigator.userAgent)?"Firefox":/opera/i.test(navigator.userAgent)?"Opera":/getcko/i.test(navigator.userAgent)?"Getcko":/msie/i.test(navigator.userAgent)?"IE":null}(),tm.VENDER_PREFIX=function(){if(!window)return;var a={Chrome:"webkit",Safari:"webkit",Firefox:"moz",Opera:"o",IE:"ms"};return a[tm.BROWSER]||""}(),tm.isMobile=function(){if(!window.navigator)return;var a=navigator.userAgent;return a.indexOf("iPhone")>0||a.indexOf("iPad")>0||a.indexOf("Android")>0}(),tm.createClass=function(a){a.init=a.init||function(){},a.superClass=a.superClass||null;var b=function(){var a=new b.prototype.creator;return b.prototype.init.apply(a,arguments),a};a.superClass&&(b.prototype=Object.create(a.superClass.prototype),b.prototype.superInit=function(){var b=this.__proto__;this.__proto__=a.superClass.prototype,a.superClass.prototype.init.apply(this,arguments),this.__proto__=b}),b.prototype.selfClass=b;for(var c in a)b.prototype[c]=a[c];return b.prototype.creator=function(){return this},b.prototype.creator.prototype=b.prototype,b},tm.using=function(){for(var a in tm)window[a]=tm[a]},tm.setLoop=function(a,b){var c=function(){var c=(new Date).getTime();a();var d=(new Date).getTime()-c,e=b-d;e=e>0?e:0,setTimeout(arguments.callee,e)};setTimeout(c,b)},tm.keyCode={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close braket":221,"single quote":222,space:32},tm.inform=function(parent){parent=parent||document.body;var eInfo=document.createElement("div");eInfo.setAttribute("class","tm-info"),eInfo.addEventListener("mouseover",function(){this.style.opacity=.9},!1),eInfo.addEventListener("mouseout",function(){this.style.opacity=.25},!1);with(eInfo.style)position="absolute",width="100%",bottom="0px",left="0px",right="0px",margin="0px",padding="10px 0px",zIndex="0",textAlign="center",fontFamily='"Meiryo", "メイリオ", "ヒラギノ角ゴ Pro W3", sans-serif',fontSize="13px",opacity="0.25",backgroundColor="rgb(230,230,255)",background="-webkit-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",background="-moz-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",WebkitTransition="1s",MozTransition="1s";eInfo.innerHTML="このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 については<a href='{projectLink}'>こちら</a>.".format({projectLink:"https://github.com/phi1618/tmlib.js"}),parent.appendChild(eInfo)}})(),function(){if(!window)return;window.requestAnimationFrame||(window.requestAnimationFrame=window[tm.VENDER_PREFIX+"RequestAnimationFrame"]||function(a){window.setTimeout(a,1e3/60)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window[tm.VENDER_PREFIX+"CancelRequestAnimationFrame"]||window.clearTimeout)}(),function(){if(!window.document)return;_loadCheckList=[],tm.addLoadCheckList=function(a){console.assert(a.isLoaded!==undefined,"isLoaded が定義されていません!!"),_loadCheckList.push(a)},_preloadListners=[],_mainListners=[],tm.preload=function(a){_preloadListners.push(a)},tm.main=function(a){_mainListners.push(a)};var a=function(){for(var a=0,b=_preloadListners.length;a<b;++a)_preloadListners[a]();_preloadListners=[]},b=function(){for(var a=0,b=_loadCheckList.length;a<b;++a){var c=_loadCheckList[a];if(c.isLoaded()==0){setTimeout(arguments.callee,0);return}}for(var a=0,b=_mainListners.length;a<b;++a)_mainListners[a]();_mainListners=[]};window.addEventListener("load",function(){a(),b()},!1)}(),function(){Object.defineProperty(Object.prototype,"defineVariable",{value:function(a,b){Object.defineProperty(this,a,{value:b,enumerable:!0})}}),Object.defineProperty(Object.prototype,"defineFunction",{value:function(a,b){Object.defineProperty(this,a,{value:b,enumerable:!1})}}),Object.prototype.defineFunction("defineInstanceVariable",function(a,b){Object.defineProperty(this.prototype,a,{value:b,enumerable:!0})}),Object.prototype.defineFunction("defineInstanceMethod",function(a,b){Object.defineProperty(this.prototype,a,{value:b,enumerable:!1})}),Object.defineInstanceMethod("setter",function(a,b){Object.defineProperty(this,a,{set:b,enumerable:!1})}),Object.defineInstanceMethod("getter",function(a,b){Object.defineProperty(this,a,{get:b,enumerable:!1})}),Object.defineInstanceMethod("accessor",function(a,b){Object.defineProperty(this,a,{set:b.set,get:b.get,enumerable:!1})}),Object.defineInstanceMethod("extend",function(){for(var a=0,b=arguments.length;a<b;++a){var c=arguments[a];for(var d in c)this[d]=c[d]}return this}),Object.defineInstanceMethod("extendSafe",function(a){for(var b in a)this[b]||(this[b]=a[b]);return this}),Object.defineInstanceMethod("extendStrict",function(a){for(var b in a)console.assert(!this[b],"TM Error: {0} is Already".format(b)),this[b]=a[b];return this}),window&&Object.defineInstanceMethod("globalize",function(a){return a?window[a]=this[a]:window.extendStrict(this),this})}(),function(){Array.flatten=function(a,b){var c=[];for(var d=0,e=a.length;d<e;++d){var f=a[d];f instanceof Array?c=c.concat(Array.flatten(f)):c.push(f)}return c},Array.prototype.accessor("first",{get:function(){return this[0]},set:function(a){this[0]=a}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(a){this[this.length-1]=a}}),Array.defineInstanceMethod("equals",function(a){for(var b=0,c=this.length;b<c;++b)if(this[b]!==a[b])return!1;return!0}),Array.defineInstanceMethod("deepEquals",function(a){for(var b=0,c=this.length;b<c;++b){var d=this[b].deepEquals?this[b].deepEquals(a[b]):this[b]===a[b];if(d===!1)return!1}return!0}),Array.defineInstanceMethod("at",function(a){return a%=this.length,a+=this.length,a%=this.length,this[a]}),Array.defineInstanceMethod("swap",function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this}),Array.defineInstanceMethod("erase",function(a){var b=this.indexOf(a);return this.splice(b,1),this}),Array.defineInstanceMethod("eraseAll",function(a){for(var b=0,c=this.length;b<c;++b)this[b]==a&&this.splice(b--,1);return this}),Array.defineInstanceMethod("eraseIf",function(a){for(var b=0,c=this.length;b<c;++b)if(a(this[b],b,this)){this.splice(b,1);break}return this}),Array.defineInstanceMethod("random",function(a,b){return a=a||0,b=b||this.length-1,this[Math.rand(a,b)]}),Array.defineInstanceMethod("uniq",function(a){var b=[];for(var c=0,d=this.length;c<d;++c){var e=this[c];e in b==0&&b.push(e)}return b}),Array.defineInstanceMethod("flatten",function(a){var b=Array.flatten(this);this.clear().concat(b);for(var c=0,d=b.length;c<d;++c)this[c]=b[c];return this}),Array.defineInstanceMethod("clone",function(a){if(a==1){var b=Array(this.length);for(var c=0,d=this.length;c<d;++c)b[c]=this[c].clone?this[c].clone(a):this[c];return b}return Array.prototype.slice.apply(this)}),Array.defineInstanceMethod("clear",function(){return this.length=0,this}),Array.defineInstanceMethod("fill",function(a,b,c){b=b||0,c=c||this.length;for(var d=b;d<c;++d)this[d]=a;return this}),Array.defineInstanceMethod("range",function(a,b,c){if(arguments.length==1){this.clear();for(var d=0;d<a;++d)this[d]=d}else if(a<b){c=c||1,this.clear();for(var d=a,e=0;d<b;d+=c,++e)this[e]=d}else{c=c||-1,this.clear();for(var d=a,e=0;d>b;d+=c,++e)this[e]=d}return this}),Array.defineInstanceMethod("shuffle",function(){for(var a=0,b=this.length;a<b;++a){var c=Math.rand(0,b-1);a!=c&&this.swap(a,c)}return this}),Array.defineInstanceMethod("toULElement",function(){}),Array.defineInstanceMethod("toOLElement",function(){})}(),function(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"],b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.prototype.format=function(c){var d=this.getFullYear(),e=this.getMonth(),f=this.getDate(),g=this.getDay(),h=this.getHours(),i=this.getMinutes(),j=this.getSeconds(),k="";for(var l=0,m=c.length;l<m;++l){var n=c.charAt(l),o="";switch(n){case"d":o=f.padding(2,"0");break;case"D":o=b[g].substr(0,3);break;case"j":o=f;break;case"l":o=b[g];break;case"F":o=a[e];break;case"m":o=(e+1).padding(2,"0");break;case"M":o=a[e].substr(0,3);break;case"n":o=e+1;break;case"Y":o=d;break;case"y":o=d.toString().substr(2,2);break;case"G":o=h;break;case"H":o=h.padding(2,"0");break;case"i":o=i.padding(2,"0");break;case"s":o=j.padding(2,"0");break;default:o=n}k+=o}return k}}(),function(){Function.prototype.bind||Function.defineInstanceMethod("bind",function(a){var b=this;return function(){b.apply(a,arguments)}}),Function.defineInstanceMethod("toArrayFunction",function(){var a=this;return function(){var b=[];for(var c=0,d=this.length;c<d;++c)b.push(a.apply(this[c],arguments));return b}})}(),function(){Math.clamp=function(a,b,c){return a<b?b:a>c?c:a},Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.degToRad=function(a){return a*Math.DEG_TO_RAD},Math.radToDeg=function(a){return a*Math.RAD_TO_DEG},Math.rand=function(a,b){return window.Math.floor(Math.random()*(b-a+1))+a},Math.randf=function(a,b){return window.Math.random()*(b-a)+a},Math.magnitude=function(){return Math.sqrt(Math.magnitudeSq.apply(null,arguments))},Math.magnitudeSq=function(){var a=0;for(var b=0,c=arguments.length;b<c;++b)a+=arguments[b]*arguments[b];return a}}(),function(){Number.defineInstanceMethod("round",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.round(c),c/b}),Number.defineInstanceMethod("ceil",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.ceil(c),c/b}),Number.defineInstanceMethod("floor",function(a){a=a||0;var b=Math.pow(10,a),c=this*b;return c=Math.floor(c),c/b}),Number.defineInstanceMethod("toInt",function(){return this|0}),Number.defineInstanceMethod("toUnsigned",function(){return this>>>0}),Number.defineInstanceMethod("toHex",function(){return this.toString(16)}),Number.defineInstanceMethod("toBin",function(){return this.toString(2)}),Number.defineInstanceMethod("padding",function(a,b){var c=this+"";a-=c.length,b=b||"0";while(a-->0)c=b+c;return c})}(),function(){String.prototype.format=function(a){var b=undefined;if(typeof a=="object")b=function(b,c){return a[c]};else{var c=arguments;b=function(a,b){return c[parseInt(b)]}}return this.replace(/\{(\w+)\}/g,b)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.capitalize=function(){return this.replace(/\w+/g,function(a){return a.capitalizeFirstLetter()})},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},String.prototype.toHash=function(){return TM.crc32(this)},String.prototype.padding=function(a,b){var c=this.toString();a-=c.length,b=b||" ";while(a-->0)c=b+c;return c},String.prototype.paddingLeft=String.prototype.padding,String.prototype.paddingRight=function(a,b){var c=this.toString();a-=c.length,b=b||" ";while(a-->0)c+=b;return c},String.prototype.repeat=function(a){var b=Array(a);for(var c=0;c<a;++c)b[c]=this;return b.join("")};var a="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.prototype.toCRC32=function(){var b=0,c=0,d=0;b^=-1;for(var e=0,f=this.length;e<f;++e)d=(b^this.charCodeAt(e))&255,c="0x"+a[d],b=b>>>8^c;return(b^-1)>>>0}}(),function(){tm.Item=tm.createClass({prev:null,next:null,data:null,init:function(){}}),tm.List=tm.createClass({init:function(){this._length=0,this._head=tm.Item(),this._tail=tm.Item(),this._head.next=this._tail,this._tail.prev=this._head},add:function(a){var b=tm.Item();return b.data=a,b.prev=this._tail.prev,b.next=this._tail,this._tail.prev.next=b,this._tail.prev=b,++this._length,this},remove:function(a){var b=this.getItem(a);return b.prev.next=b.next,b.next.prev=b.prev,--this._length,b},get:function(a){return this.getItem(a).data},getItem:function(a){var b=this._head.next,c=0;while(c++<a)b=b.next;return b},forEach:function(a){},clear:function(){},clone:function(){},getFirst:function(){},getLast:function(){},indexOf:function(a){},lastIndexOf:function(a){},toArray:function(){if(this._length<=0)return[];var a=this._head.next,b=[];while(a.data!=null)b.push(a.data),a=a.next;return b},toString:function(){var a=this.toArray();for(var b=0,c=a.length;b<c;++b)a[b]=a[b].toString();return a.join(",")}})}(),tm.util=tm.util||{},function(){tm.util.Random={randint:function(a,b){return window.Math.floor(Math.random()*(b-a+1))+a},randfloat:function(a,b){return window.Math.random()*(b-a)+a},randbool:function(){return this.randint(0,1)===1}}}(),tm.util=tm.util||{},function(){var AJAX_DEFAULT_SETTINGS={type:"POST",async:!0,data:null,contentType:"application/x-www-form-urlencoded",dataType:"text",username:null,password:null,success:function(a){alert("success!!\n"+a)},error:function(a){alert("error!!")}};tm.util.Ajax={load:function(a){for(var b in AJAX_DEFAULT_SETTINGS)a[b]=a[b]||AJAX_DEFAULT_SETTINGS[b];var c=new XMLHttpRequest,d="",e=tm.util.Ajax.DATA_CONVERTE_TABLE[a.dataType];c.onreadystatechange=function(){if(c.readyState==4)if(c.status===200){var b=e[c.responseText];a.success(b)}else if(c.status===0){var b=e(c.responseText);a.success(b)}else a.error(c.responseText)},c.open(a.type,a.url,a.async,a.username,a.password),c.setRequestHeader("Content-Type",a.contentType),c.send(null)}},tm.util.Ajax.DATA_CONVERTE_TABLE={"undefined":function(a){return a},text:function(a){return a},xml:function(a){var b=document.createElement("div");return b.innerHTML=a,b},dom:function(a){var b=document.createElement("div");return b.innerHTML=a,tm.dom.Element(b)},json:function(a){return JSON.parse(a)},script:function(data){return eval(data),data},bin:function(a){var b=[];for(var c=0,d=a.length;c<d;++c)b[c]=a.charCodeAt(c)&255;return b}}}(),tm.util=tm.util||{},function(){tm.util.File=tm.createClass({init:function(a){this.loaded=!1,arguments.length==1&&this.loadFile(a)},loadFile:function(a){if(typeof a=="string"){var b=a;a={url:b}}var c=this;a.success=function(a){c.loaded=!0,c.data=a},tm.util.Ajax.load(a)},loadLocalStorage:function(){}})}(),function(){tm.util.FileManager={files:{}},tm.util.FileManager.load=function(a,b){var c=tm.util.File(b);return this.files[a]=c,c},tm.util.FileManager.get=function(a){return this.files[a]},tm.util.FileManager.isLoaded=function(){for(var a in this.files){var b=this.files[a];if(b.loaded==0)return!1}return!0},tm.addLoadCheckList(tm.util.FileManager)}(),tm.util=tm.util||{},function(){tm.util.Timeline=tm.createClass({target:null,tasks:null,fps:30,init:function(){this.tasks=[],this.time=0},at:function(a,b){return this.tasks.push({time:a,action:b}),this},after:function(a,b){return this.at(this.time+a,b),this},clear:function(){return this.tasks=[],this},removeTime:function(a){},removeAction:function(a){},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime()},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime()},stop:function(){this.isPlaying=!1},rewind:function(){this.time=0},update:function(){if(this.tasks.length>0)for(var a=0,b=this.tasks.length;a<b;++a){var c=this.tasks[a];this.prev<=c.time&&c.time<this.time&&c.action()}},_startTime:function(){this.startTime=(new Date).getTime()},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_updateTime:function(){this.isPlaying&&(this._nextTime(),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_nextTime:function(){this.prev=this.time,this.time=(new Date).getTime()-this.startTime,this.update()}})}(),tm.util=tm.util||{},function(){tm.util.DataManager={data:{}},tm.util.DataManager.save=function(a){},tm.util.DataManager.load=function(a,b){},tm.util.DataManager.set=function(a,b){return this.data[a]=b,this},tm.util.DataManager.get=function(a){return this.data[a]}}(),tm.geom=tm.geom||{},function(){tm.geom.Vector2=tm.createClass({x:0,y:0,init:function(a,b){this.set(a,b)},clone:function(){return tm.geom.Vector2(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y?!0:!1},equalsNumber:function(a,b){return this.x===a&&this.y===b?!0:!1},equalsArray:function(a){return this.x===a[0]&&this.y===a[1]?!0:!1},set:function(a,b){this.x=a,this.y=b},setNumber:function(a,b){return this.x=a,this.y=b,this},setArray:function(a){return this.x=a[0],this.y=a[1],this},setObject:function(a){return this.x=a.x,this.y=a.y,this},setString:function(a){var b=a.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(b[1]),this.y=parseFloat(b[3]),this},setSmart:function(a,b){var c=arguments[0];if(arguments.length===2)this.x=a,this.y=b;else if(c instanceof Array)this.x=c[0],this.y=c[1];else if(c instanceof Object)this.x=c.x,this.y=c.y;else if(typeof c=="string"){var d=c.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(d[1]),this.y=parseFloat(d[3])}return this},setAngle:function(a,b){var c=a*Math.DEG_TO_RAD;return b=b||1,this.x=Math.cos(c)*b,this.y=Math.sin(c)*b,this},setRadian:function(a,b){return b=b||1,this.x=Math.cos(a)*b,this.y=Math.sin(a)*b,this},setDegree:function(a,b){var c=a*Math.DEG_TO_RAD;return b=b||1,this.x=Math.cos(c)*b,this.y=Math.sin(c)*b,this},setRandom:function(a,b,c){return a=a||0,b=b||360,c=c||1,this.setDegree(Math.randf(a,b),c),this},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},mul:function(a){return this.x*=a,this.y*=a,this},div:function(a){return a=a||.01,this.x/=a,this.y/=a,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},distanceSquared:function(a){return Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)},normalize:function(){var a=this.length();return this.div(a),this},toAngle:function(){return Math.atan2(this.y,this.x)},toStyleString:function(){return"{x:{x}, y:{y}}".format(this)},toString:function(){return"{x:{x}, y:{y}}".format(this)},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this}}),tm.geom.Vector2.min=function(a,b){return tm.geom.Vector2(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y)},tm.geom.Vector2.max=function(a,b){return tm.geom.Vector2(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y)},tm.geom.Vector2.add=function(a,b){return tm.geom.Vector2(a.x+b.x,a.y+b.y)},tm.geom.Vector2.sub=function(a,b){return tm.geom.Vector2(a.x-b.x,a.y-b.y)},tm.geom.Vector2.mul=function(a,b){return tm.geom.Vector2(a.x*b,a.y*b)},tm.geom.Vector2.div=function(a,b){return tm.geom.Vector2(a.x/b,a.y/b)},tm.geom.Vector2.negate=function(){return tm.geom.Vector2(-this.x,-this.y)},tm.geom.Vector2.dot=function(a,b){return a.x*b.x+a.y*b.y},tm.geom.Vector2.cross=function(a,b){return a.x*b.y-a.y*b.x},tm.geom.Vector2.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},tm.geom.Vector2.distanceSquared=function(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)},tm.geom.Vector2.manhattanDistance=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},tm.geom.Vector2.reflect=function(a,b){var c=Vector2.dot(a,b),d=Vector2.mul(b,2*c);return tm.geom.Vector2.sub(a,d)},tm.geom.Vector2.lerp=function(a,b,c){return tm.geom.Vector2(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c)},tm.geom.Vector2.slerp=function(a,b,c){},tm.geom.Vector2.random=function(a,b,c){return a=a||0,b=b||360,c=c||1,tm.geom.Vector2().setDegree(Math.randf(a,b),c)},tm.geom.Vector2.ZERO=tm.geom.Vector2(0,0),tm.geom.Vector2.LEFT=tm.geom.Vector2(-1,0),tm.geom.Vector2.RIGHT=tm.geom.Vector2(1,0),tm.geom.Vector2.UP=tm.geom.Vector2(0,1),tm.geom.Vector2.DOWN=tm.geom.Vector2(0,-1)}(),tm.geom=tm.geom||{},function(){tm.geom.Vector3=tm.createClass({x:0,y:0,z:0,init:function(a,b,c){this.set(a,b,c)},set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setNumber:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},setObject:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},setString:function(a){var b=a.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(b[1]),this.y=parseFloat(b[3]),this.z=parseFloat(b[5]),this},setAngle:function(a,b,c){return c=c||1,this.x=c*Math.cos(a)*Math.sin(b),this.y=c*Math.sin(a),this.z=c*Math.cos(a)*Math.cos(b),this},setRadian:function(a,b,c){return this.setFromAngle(a,b,c)},setDegree:function(a,b,c){return this.setFromAngle(a*Math.PI/180,b*Math.PI/180,c)},setSmart:function(a,b,c){var d=arguments[0];if(arguments.length===3)this.x=a,this.y=b,this.z=c;else if(d instanceof Array)this.x=d[0],this.y=d[1],this.z=d[2];else if(d instanceof Object)this.x=d.x,this.y=d.y,this.z=d.z;else if(typeof d=="string"){var e=d.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this.z=parseFloat(e[5])}return this},add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},mul:function(a){return this.x*=a,this.y*=a,this.z*=a,this},div:function(a){return console.assert(a!=0,"0 division!!"),this.x/=a,this.y/=a,this.z/=a,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){var a=this.length();return this.div(a),this},toVector2:function(){},toAngleXY:function(){return Math.atan2(this.y,this.x)},to3D:function(){},equals:function(a,b,c){return this.x===a&&this.y===b&&this.z===c},equalsArray:function(a){return this.equals(a[0],a[1],a[2])},equalsObject:function(a){return this.equals(a.x,a.y,a.z)},equalsSmart:function(){},toStyleString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},toString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this}}),tm.geom.Vector3.min=function(a,b){return Vector3(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y,a.z<b.z?a.z:b.z)},tm.geom.Vector3.max=function(a,b){return Vector3(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y,a.z>b.z?a.z:b.z)},tm.geom.Vector3.add=function(a,b){return tm.geom.Vector3(a.x+b.x,a.y+b.y,a.z+b.z)},tm.geom.Vector3.sub=function(a,b){return tm.geom.Vector3(a.x-b.x,a.y-b.y,a.z-b.z)},tm.geom.Vector3.mul=function(a,b){return tm.geom.Vector3(a.x*b,a.y*b,a.z*b)},tm.geom.Vector3.div=function(a,b){return tm.geom.Vector3(a.x/b,a.y/b,a.z/b)},tm.geom.Vector3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},tm.geom.Vector3.cross=function(a,b){},tm.geom.Vector3.negate=function(a){return tm.geom.Vector3(-a.x,-a.y,-a.z)},tm.geom.Vector3.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2))},tm.geom.Vector3.distanceSquared=function(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2)},tm.geom.Vector3.manhattanDistance=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)+Math.abs(a.z-b.z)},tm.geom.Vector3.reflect=function(a,b){var c=Vector3.dot(a,b),d=Vector3.mul(b,2*c);return Vector3.sub(a,d)},tm.geom.Vector3.lerp=function(a,b,c){return tm.geom.Vector3(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c,a.z+(b.z-a.z)*c)},tm.geom.Vector3.slerp=function(a,b,c){},tm.geom.Vector3.random=function(a,b,c,d,e){return a=a||0,b=b||360,c=c||0,d=d||360,e=e||1,TM.Geom.Vector3().setFromDegree(TM.randomf(a,b),TM.randomf(c,d),e)},tm.geom.Vector3.ZERO=tm.geom.Vector3(0,0,0),tm.geom.Vector3.LEFT=tm.geom.Vector3(-1,0,0),tm.geom.Vector3.RIGHT=tm.geom.Vector3(1,0,0),tm.geom.Vector3.UP=tm.geom.Vector3(0,1,0),tm.geom.Vector3.DOWN=tm.geom.Vector3(0,-1,0),tm.geom.Vector3.FORWARD=tm.geom.Vector3(0,0,-1),tm.geom.Vector3.BACKWARD=tm.geom.Vector3(0,0,1)}(),tm.geom=tm.geom||{},function(){tm.geom.Matrix33=tm.createClass({m:null,init:function(){this.m=[],arguments.length>=9?this.set.apply(this,arguments):this.identity()},clone:function(){var a=this.m;return tm.geom.Matrix33(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])},set:function(a,b,c,d,e,f,g,h,i){return console.assert(arguments.length>=9,""),this.m00=a,this.m01=b,this.m02=c,this.m10=d,this.m11=e,this.m12=f,this.m20=g,this.m21=h,this.m22=i,this},setArray:function(a){return this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]),this},setObject:function(a){return this.set(a.m00,a.m01,a.m02,a.m10,a.m11,a.m12,a.m20,a.m21,a.m22),this},identity:function(){var a=this.m;return a[0]=1,a[3]=0,a[6]=0,a[1]=0,a[4]=1,a[7]=0,a[2]=0,a[5]=0,a[8]=1,this},transpose:function(){return this.m.swap(1,3),this.m.swap(2,6),this.m.swap(5,7),this},invert:function(){var a=this.m,b=a[0],c=a[3],d=a[6],e=a[1],f=a[4],g=a[7],h=a[2],i=a[5],j=a[8],k=this.determinant();return this.m00=(f*j-g*i)/k,this.m01=(e*j-g*h)/k*-1,this.m02=(e*i-f*h)/k,this.m10=(c*j-d*i)/k*-1,this.m11=(b*j-d*h)/k,this.m12=(b*i-c*h)/k*-1,this.m20=(c*g-d*f)/k,this.m21=(b*g-d*e)/k*-1,this.m22=(b*f-c*e)/k,this.transpose(),this},determinant:function(){var a=this.m,b=a[0],c=a[3],d=a[6],e=a[1],f=a[4],g=a[7],h=a[2],i=a[5],j=a[8];return b*f*j+e*i*d+c*g*h-d*f*h-c*e*j-g*i*b},zero:function(){return this.set(0,0,0,0,0,0,0,0,0),this},translate:function(a,b){var c=this.m;return c[6]=c[0]*a+c[3]*b+c[6],c[7]=c[1]*a+c[4]*b+c[7],c[8]=c[2]*a+c[5]*b+c[8],this},rotateX:function(a){return this.multiply(tm.geom.Matrix33.rotateX(a))},rotateY:function(a){return this.multiply(tm.geom.Matrix33.rotateY(a))},rotateZ:function(a){var b=Math.sin(a),c=Math.cos(a),d=this.m,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5];return this.multiply(tm.geom.Matrix33.rotateZ(a))},scale:function(a,b){var c=this.m;return c[0]*=a,c[3]*=b,c[1]*=a,c[4]*=b,c[2]*=a,c[5]*=b,this},multiply:function(a){var b=this.m,c=a.m,d=b[0],e=b[3],f=b[6],g=b[1],h=b[4],i=b[7],j=b[2],k=b[5],l=b[8],m=c[0],n=c[3],o=c[6],p=c[1],q=c[4],r=c[7],s=c[2],t=c[5],u=c[8];return b[0]=d*m+e*p+f*s,b[3]=d*n+e*q+f*t,b[6]=d*o+e*r+f*u,b[1]=g*m+h*p+i*s,b[4]=g*n+h*q+i*t,b[7]=g*o+h*r+i*u,b[2]=j*m+k*p+l*s,b[5]=j*n+k*q+l*t,b[8]=j*o+k*r+l*u,this},multiplyVector2:function(a){var b=this.m00*a.x+this.m01*a.y+this.m02,c=this.m10*a.x+this.m11*a.y+this.m12;return tm.geom.Vector2(b,c)},multiplyVector3:function(a){var b=this.m00*a.x+this.m01*a.y+this.m02*a.z,c=this.m10*a.x+this.m11*a.y+this.m12*a.z,d=this.m20*a.x+this.m21*a.y+this.m22*a.z;return tm.geom.Vector3(b,c,d)},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),tm.geom.Matrix33.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix33.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix33.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(a){this.m[2]=a}}),tm.geom.Matrix33.prototype.accessor("m01",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix33.prototype.accessor("m11",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix33.prototype.accessor("m21",{get:function(){return this.m[5]},set:function(a){this.m[5]=a}}),tm.geom.Matrix33.prototype.accessor("m02",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix33.prototype.accessor("m12",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix33.prototype.accessor("m22",{get:function(){return this.m[8]},set:function(a){this.m[8]=a}}),tm.geom.Matrix33.prototype.accessor("a",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix33.prototype.accessor("b",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix33.prototype.accessor("c",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix33.prototype.accessor("d",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix33.prototype.accessor("tx",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix33.prototype.accessor("ty",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix33.translate=function(a,b){return tm.geom.Matrix33(1,0,a,0,1,b,0,0,1)},tm.geom.Matrix33.rotateX=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(1,0,0,0,b,-c,0,c,b)},tm.geom.Matrix33.rotateY=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(b,0,c,0,1,0,-c,0,b)},tm.geom.Matrix33.rotateZ=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix33(b,-c,0,c,b,0,0,0,1)},tm.geom.Matrix33.scale=function(a,b){var c=tm.geom.Matrix33();return b==undefined&&(b=a),c.set(a,0,0,0,b,0,0,0,1),c}}(),tm.geom=tm.geom||{},function(){tm.geom.Matrix44=tm.createClass({m:null,init:function(){this.m=[],arguments.length>=16?this.set.apply(this,arguments):this.identity()},set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return console.assert(arguments.length>=16,""),this.m00=a,this.m01=b,this.m02=c,this.m03=d,this.m10=e,this.m11=f,this.m12=g,this.m13=h,this.m20=i,this.m21=j,this.m22=k,this.m23=l,this.m30=m,this.m31=n,this.m32=o,this.m33=p,this},setArray:function(a){return this.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]),this},setObject:function(a){return this.set(a.m00,a.m01,a.m02,a.m03,a.m10,a.m11,a.m12,a.m13,a.m20,a.m21,a.m22,a.m23,a.m30,a.m31,a.m32,a.m33),this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},translate:function(a,b,c){return this.multiply(tm.geom.Matrix44.translate(a,b,c))},rotate:function(a){console.error("Unimplemented")},rotateX:function(a){return this.multiply(tm.geom.Matrix44.rotateX(a))},rotateY:function(a){return this.multiply(tm.geom.Matrix44.rotateY(a))},rotateZ:function(a){return this.multiply(tm.geom.Matrix44.rotateZ(a))},scale:function(a,b,c){return this.multiply(tm.geom.Matrix44.scale(a,b,c))},zero:function(){return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this},multiply:function(a){var b=this.m00*a.m00+this.m01*a.m10+this.m02*a.m20+this.m03*a.m30,c=this.m00*a.m01+this.m01*a.m11+this.m02*a.m21+this.m03*a.m31,d=this.m00*a.m02+this.m01*a.m12+this.m02*a.m22+this.m03*a.m32,e=this.m00*a.m03+this.m01*a.m13+this.m02*a.m23+this.m03*a.m33,f=this.m10*a.m00+this.m11*a.m10+this.m12*a.m20+this.m13*a.m30,g=this.m10*a.m01+this.m11*a.m11+this.m12*a.m21+this.m13*a.m31,h=this.m10*a.m02+this.m11*a.m12+this.m12*a.m22+this.m13*a.m32,i=this.m10*a.m03+this.m11*a.m13+this.m12*a.m23+this.m13*a.m33,j=this.m20*a.m00+this.m21*a.m10+this.m22*a.m20+this.m23*a.m30,k=this.m20*a.m01+this.m21*a.m11+this.m22*a.m21+this.m23*a.m31,l=this.m20*a.m02+this.m21*a.m12+this.m22*a.m22+this.m23*a.m32,m=this.m20*a.m03+this.m21*a.m13+this.m22*a.m23+this.m23*a.m33,n=this.m30*a.m00+this.m31*a.m10+this.m32*a.m20+this.m33*a.m30,o=this.m30*a.m01+this.m31*a.m11+this.m32*a.m21+this.m33*a.m31,p=this.m30*a.m02+this.m31*a.m12+this.m32*a.m22+this.m33*a.m32,q=this.m30*a.m03+this.m31*a.m13+this.m32*a.m23+this.m33*a.m33;return this.set(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q)},getAxisX:function(){return TM.Geom.Vector3(this.m00,this.m01,this.m02)},getAxisY:function(){return TM.Geom.Vector3(this.m10,this.m11,this.m12)},getAxisZ:function(){return TM.Geom.Vector3(this.m20,this.m21,this.m22)},setAxisX:function(a){this.m00=a.x,this.m01=a.y,this.m02=a.z},setAxisY:function(a){this.m10=a.x,this.m11=a.y,this.m12=a.z},setAxisZ:function(a){this.m20=a.x,this.m21=a.y,this.m22=a.z},toMatrix33:function(){},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}, {m03}|\n|{m10}, {m11}, {m12}, {m13}|\n|{m20}, {m21}, {m22}, {m23}|\n|{m30}, {m31}, {m32}, {m33}|".format(this)}}),tm.geom.Matrix44.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(a){this.m[0]=a}}),tm.geom.Matrix44.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(a){this.m[1]=a}}),tm.geom.Matrix44.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(a){this.m[2]=a}}),tm.geom.Matrix44.prototype.accessor("m30",{get:function(){return this.m[3]},set:function(a){this.m[3]=a}}),tm.geom.Matrix44.prototype.accessor("m01",{get:function(){return this.m[4]},set:function(a){this.m[4]=a}}),tm.geom.Matrix44.prototype.accessor("m11",{get:function(){return this.m[5]},set:function(a){this.m[5]=a}}),tm.geom.Matrix44.prototype.accessor("m21",{get:function(){return this.m[6]},set:function(a){this.m[6]=a}}),tm.geom.Matrix44.prototype.accessor("m31",{get:function(){return this.m[7]},set:function(a){this.m[7]=a}}),tm.geom.Matrix44.prototype.accessor("m02",{get:function(){return this.m[8]},set:function(a){this.m[8]=a}}),tm.geom.Matrix44.prototype.accessor("m12",{get:function(){return this.m[9]},set:function(a){this.m[9]=a}}),tm.geom.Matrix44.prototype.accessor("m22",{get:function(){return this.m[10]},set:function(a){this.m[10]=a}}),tm.geom.Matrix44.prototype.accessor("m32",{get:function(){return this.m[11]},set:function(a){this.m[11]=a}}),tm.geom.Matrix44.prototype.accessor("m03",{get:function(){return this.m[12]},set:function(a){this.m[12]=a}}),tm.geom.Matrix44.prototype.accessor("m13",{get:function(){return this.m[13]},set:function(a){this.m[13]=a}}),tm.geom.Matrix44.prototype.accessor("m23",{get:function(){return this.m[14]},set:function(a){this.m[14]=a}}),tm.geom.Matrix44.prototype.accessor("m33",{get:function(){return this.m[15]},set:function(a){this.m[15]=a}}),tm.geom.Matrix44.translate=function(a,b,c){return tm.geom.Matrix44(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1)},tm.geom.Matrix44.rotateX=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1)},tm.geom.Matrix44.rotateY=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1)},tm.geom.Matrix44.rotateZ=function(a){var b=Math.cos(a),c=Math.sin(a);return tm.geom.Matrix44(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1)},tm.geom.Matrix44.scale=function(a,b,c){var d=tm.geom.Matrix44();return b==undefined&&(b=a),c==undefined&&(c=a),d.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),d}}(),tm.geom=tm.geom||{},function(){tm.geom.Rect=tm.createClass({x:0,y:0,width:0,height:0,init:function(a,b,c,d){this.set(a,b,c,d)},set:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},move:function(a,b){return this.x=a,this.y=b,this},moveBy:function(a,b){return this.x+=a,this.y+=b,this},resize:function(a,b){return this.width=a,this.height=b,this},resizeBy:function(a,b){return this.width+=a,this.height+=b,this},padding:function(a,b,c,d){switch(arguments.length){case 1:a=b=c=d=arguments[0];break;case 2:a=c=arguments[0],b=d=arguments[1];break;case 3:a=arguments[0],b=d=arguments[1],c=arguments[2]}return this.x+=d,this.y+=a,this.width-=d+b,this.height-=a+c,this},clone:function(){},toCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,this.width<this.height?this.width:this.height)},toArray:function(){return[this.x,this.y,this.width,this.height]}}),tm.geom.Rect.prototype.accessor("left",{get:function(){return this.x},set:function(a){this.width-=a-this.x,this.x=a}}),tm.geom.Rect.prototype.accessor("top",{get:function(){return this.y},set:function(a){this.height-=a-this.y,this.y=a}}),tm.geom.Rect.prototype.accessor("right",{get:function(){return this.x+this.width},set:function(a){this.width+=a-this.right}}),tm.geom.Rect.prototype.accessor("bottom",{get:function(){return this.y+this.height},set:function(a){this.height+=a-this.bottom}}),tm.geom.Rect.prototype.accessor("centerX",{get:function(){return this.x+this.width/2},set:function(a){}}),tm.geom.Rect.prototype.accessor("centerY",{get:function(){return this.y+this.height/2},set:function(a){}})}(),tm.geom=tm.geom||{},function(){tm.geom.Circle=tm.createClass({x:0,y:0,radius:0,init:function(a,b,c){this.set(a,b,c)},set:function(a,b,c){return this.x=a,this.y=b,this.radius=c,this},move:function(a,b){return this.x=a,this.y=b,this},moveBy:function(a,b){return this.x+=a,this.y+=b,this},resize:function(a){return this.radius=a,this},resizeBy:function(a){return this.radius+=a,this},clone:function(){},toRectangle:function(){return tm.geom.Rectangle(this.x,this.y,this.radius*2,this.radius*2)},toArray:function(){return[this.x,this.y,this.radius]}}),tm.geom.Circle.prototype.getter("left",function(){return this.x-this.radius}),tm.geom.Circle.prototype.getter("top",function(){return this.y-this.radius}),tm.geom.Circle.prototype.getter("right",function(){return this.x+this.radius}),tm.geom.Circle.prototype.getter("bottom",function(){return this.y+this.radius})}(),function(){var a=document.createElement("div");a.innerText===undefined&&HTMLElement.prototype.accessor("innerText",{get:function(){return this.textContent},set:function(a){this.textContent=a}})}(),tm.dom=tm.dom||{},function(){tm.dom.Element=tm.createClass({element:null,init:function(){this.set.apply(this,arguments)},set:function(a){typeof a=="string"?this.element=document.querySelector(a):a!=undefined?this.element=a:this.element=document},append:function(a){return this.element.appendChild(a.element),this},prepend:function(a){return this.element.insertBefore(a.element,this.element.firstChild),this},after:function(a){return this.element.parentNode.insertBefore(a.element,this.element.nextSibling),this},before:function(a){return this.element.parentNode.insertBefore(a.element,this.element),this},appendTo:function(a){return a.append(this),this},prependTo:function(a){return a.prepend(this),this},clone:function(){return tm.dom.Element(this.element.cloneNode(!0))},remove:function(){return this.element.parentNode.removeChild(this.element),this},create:function(a,b){var c=tm.dom.Element(document.createElement(a));return b||(b="append"),this[b](c),c},query:function(a,b){var c=b?this.element.querySelectorAll(a)[b]:this.element.querySelector(a);return tm.dom.Element(c)},queryAll:function(a){var b=this.element.querySelectorAll(a);return tm.dom.ElementList(b)},fixed:function(a,b,c,d){return this.style.set("position","fixed"),a&&(this.x=a),b&&(this.y=b),c&&(this.width=c),d&&(this.height=d),this},absolute:function(a,b,c,d){return this.style.set("position","absolute"),a&&(this.x=a),b&&(this.y=b),c&&(this.width=c),d&&(this.height=d),this},fullScreen:function(){this.element.webkitRequestFullScreen()},toString:function(){return"tm.dom.element"},getElement:function(){return this.element}}),tm.dom.Element.prototype.accessor("html",{get:function(){return this.element.innerHTML},set:function(a){this.element.innerHTML=a}}),tm.dom.Element.prototype.accessor("value",{get:function(){return this.element.value},set:function(a){this.element.value=a}}),tm.dom.Element.prototype.accessor("x",{get:function(){return Number(this.element.style.left.replace("px",""))},set:function(a){this.element.style.left=a+"px"}}),tm.dom.Element.prototype.accessor("y",{get:function(){return Number(this.element.style.top.replace("px",""))},set:function(a){this.element.style.top=a+"px"}}),tm.dom.Element.prototype.accessor("width",{get:function(){return Number(this.element.style.width.replace("px",""))},set:function(a){this.element.style.width=a+"px"}}),tm.dom.Element.prototype.accessor("height",{get:function(){return Number(this.element.style.height.replace("px",""))},set:function(a){this.element.style.height=a+"px"}}),tm.dom.Element.prototype.accessor("color",{get:function(){return this.element.style.color},set:function(a){this.element.style.color=a}}),tm.dom.Element.prototype.accessor("backgroundColor",{get:function(){return this.element.style.backgroundColor},set:function(a){this.element.style.backgroundColor=a}}),tm.dom.Element.prototype.accessor("visible",{get:function(){return this.element.style.visibility!="hidden"},set:function(a){this.element.style.visibility=a==1?"visible":"hidden"}}),tm.dom.Element.prototype.accessor("text",{get:function(){return this.element.innerText},set:function(a){this.element.innerText=a}}),tm.dom.Element.prototype.getter("parent",function(){return this.element.parent!=undefined?tm.dom.Element(this.element.parent):null}),tm.dom.Element.prototype.getter("prev",function(){return this.element.previousSibling!=undefined?tm.dom.Element(this.element.previousSibling):null}),tm.dom.Element.prototype.getter("next",function(){return this.element.nextSibling!=undefined?tm.dom.Element(this.element.nextSibling):null}),tm.dom.Element.prototype.getter("children",function(){return tm.dom.ElementList(this.element.children)})}(),function(){tm.dom.ElementList=tm.createClass({superClass:Array,init:function(a){if(typeof arguments[0]=="string"){var b=arguments[0];a=document.querySelectorAll(b)}else if(a==undefined)return;for(var c=0,d=a.length;c<d;++c)this.push(tm.dom.Element(a[c]))},toString:function(){return""}})}(),tm.dom=tm.dom||{},function(){Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()}}(),function(){KeyboardEvent.prototype.getter("character",function(){return String.fromCharCode(this.keyCode)})}(),function(){MouseEvent.prototype.getter("pointX",function(){return this.pageX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.pageY-this.target.getBoundingClientRect().top})}(),function(){if(window.TouchEvent===undefined)return;TouchEvent.prototype.getter("pointX",function(){return this.touches[0].pageX}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].pageY})}(),function(){tm.dom.Event=tm.createClass({element:null,funcList:null,funcIndex:0,init:function(a){this.element=a,this.funcList={}},add:function(a,b,c){var d=this,e=tm.dom.Element(this.element),f=function(a){var c=b.apply(e,arguments);return c===!1&&(a.preventDefault(),a.returnValue=!1,a.stopPropagation()),c};return this._funcIndex=this._funcIndex||0,c=c||this._funcIndex++,this.funcList[a]=this.funcList[a]||{},this.funcList[a][c]=f,b._id=c,this.element.addEventListener(a,f,!1),this},remove:function(a,b){var c=typeof b=="function"?b._id:b,d=this.getFunc(a,c);this.element.removeEventListener(a,d,!1),delete this.funcList[a][c]},click:function(a,b){return this.add("click",a,b),this},mdlclick:function(a,b){var c=function(b){b.button==1&&a(b)};this.add("click",c,b)},pointstart:function(a,b){this.add(tm.dom.Event.POINT_START,a,b)},pointmove:function(a,b){this.add(tm.dom.Event.POINT_MOVE,a,b)},pointend:function(a,b){this.add(tm.dom.Event.POINT_END,a,b)},hover:function(a,b){return this.add("mouseover",a,b),this},one:function(a,b,c){var d=this,e=TM.$DOMElement(this.element),f=function(){var c=b.apply(e,arguments);return d.remove(a,f),c};return this.add(a,f,c),this},toggle:function(a,b){var c=this,d=TM.$DOMElement(this.element),e=[];for(var f=0;f<b.length;++f){var g=function(f){return function(){var g=b[f].apply(d,arguments);if(g!==!1){var h=(f+1)%b.length;c.one(a,e[h])}}}(f);e.push(g)}return this.one(a,e[0]),this},getFunc:function(a,b){return this.funcList[a][b]}}),tm.dom.Event.POINT_START=tm.isMobile?"touchstart":"mousedown",tm.dom.Event.POINT_MOVE=tm.isMobile?"touchmove":"mousemove",tm.dom.Event.POINT_END=tm.isMobile?"touchend":"mouseup",tm.dom.Element.prototype.getter("event",function(){return this._event||(this._event=tm.dom.Event(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Attr=tm.createClass({element:null,init:function(a){this.element=a},set:function(a,b){return this.element.setAttribute(a,b),this},add:function(a,b){var c=this.get(a);b=c?c+" "+b:b,this.element.setAttribte(a,b)},remove:function(a){this.element.removeAttribute(a)},get:function(a){return this.element.getAttribute(a)}}),tm.dom.Element.prototype.getter("attr",function(){return this._trans||(this._attr=tm.dom.Attr(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Style=tm.createClass({element:null,init:function(a){this.element=a},set:function(a,b){return this.element.style[a]=b,this},remove:function(a){return this.element.style.removeProperty(a),this},clear:function(a){return this},get:function(a){return this.element.style[a]},getPropValue:function(a){return document.defaultView.getComputedStyle(this.element,"").getPropertyValue(a)}}),tm.dom.Element.prototype.getter("style",function(){return this._style||(this._style=tm.dom.Style(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Anim=tm.createClass({init:function(a){this.element=a;var b=this;this.element.addEventListener("webkitAnimationEnd",function(){b.stop()},!1)},start:function(){return this.element.style.webkitAnimationPlayState="running",this},stop:function(){return this.element.style.webkitAnimationPlayState="paused",this},setProperty:function(b){if(typeof b=="string")this.element.style.webkitAnimation=b;else for(var c in b){var d=a[c],e=b[c];d.call(this,e)}return this},setName:function(a){return this.element.style.webkitAnimationName=a,this},setDuration:function(a){return this.element.style.webkitAnimationDuration=a,this},setTimingFunction:function(a){return this.element.style.webkitAnimationTimingFunction=a,this},setIterationCount:function(a){return this.element.style.webkitAnimationIterationCount=a,this},setDelay:function(a){return this.element.style.webkitAnimationDelay=a,this},setDirection:function(a){return this.element.style.webkitAnimationDirection=a,this}});var a={name:tm.dom.Anim.prototype.setName,duration:tm.dom.Anim.prototype.setDuration,timingFunction:tm.dom.Anim.prototype.setTimingFunction,iterationCount:tm.dom.Anim.prototype.setIterationCount,delay:tm.dom.Anim.prototype.setDelay,Name:tm.dom.Anim.prototype.setName,Duration:tm.dom.Anim.prototype.setDuration,TimingFunction:tm.dom.Anim.prototype.setTimingFunction,IterationCount:tm.dom.Anim.prototype.setIterationCount,Delay:tm.dom.Anim.prototype.setDelay};tm.dom.Element.prototype.getter("anim",function(){return this._anim||(this._anim=tm.dom.Anim(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Trans=tm.createClass({element:null,init:function(a){this.element=a},setProp:function(a){var c=this.element.style,d=[];for(var e in a){var f=b(e);d.push(f.toDash()),c[f]=a[e]}return c[tm.dom.Trans.PROPERTY]=d.join(", "),this},setDuration:function(a){var b=this.element.style;return b[tm.dom.Trans.DURATION]=a,this},setTimingFunction:function(a){var b=this.element.style;return b[tm.dom.Trans.TIMING_FUNCTION]=a,this},resetProp:function(){var a=this.element.style;return a[tm.dom.Trans.PROPERTY]="none",this},setEndFunction:function(a){return this.dom.event.add(tm.dom.Trans.END_EVENT,a),this}}),tm.dom.Trans.PROPERTY=tm.VENDER_PREFIX+"TransitionProperty",tm.dom.Trans.DURATION=tm.VENDER_PREFIX+"TransitionDuration",tm.dom.Trans.TIMING_FUNCTION=tm.VENDER_PREFIX+"TransitionTimingFunction",tm.dom.Trans.DELAY=tm.VENDER_PREFIX+"TransitionDelay",tm.dom.Trans.END_EVENT=function(){return{webkit:"webkitTransitionEnd",moz:"transitionend",o:"oTransitionEnd"}[tm.VENDER_PREFIX]}(),tm.dom.Element.prototype.getter("trans",function(){return this._trans||(this._trans=tm.dom.Trans(this.element))});var a={transform:!0},b=function(b){return a[b]===!0?"-"+tm.VENDER_PREFIX+b.capitalizeFirstLetter():b}}(),tm.event=tm.event||{},function(){tm.event.Event=tm.createClass({type:null,init:function(a){this.type=a}})}(),function(){tm.event.TweenEvent=tm.createClass({superClass:tm.event.Event,init:function(a,b,c){this.superInit(a),this.time=b,this.now=c}}),tm.event.TweenEvent.CHANGE="change",tm.event.TweenEvent.FINISH="finish",tm.event.TweenEvent.LOOP="loop",tm.event.TweenEvent.RESUME="resume",tm.event.TweenEvent.START="start",tm.event.TweenEvent.STOP="stop"}(),function(){tm.event.MouseEvent=tm.createClass({superClass:tm.event.Event,init:function(a,b){this.superInit(a),this.app=b}})}(),function(){tm.event.TouchEvent=tm.createClass({superClass:tm.event.Event,init:function(a,b){this.superInit(a),this.app=b}})}(),function(){tm.event.PointingEvent=tm.createClass({superClass:tm.event.Event,init:function(a,b){this.superInit(a),this.app=b}})}(),tm.event=tm.event||{},function(){tm.event.EventDispatcher=tm.createClass({init:function(){this._listeners={}},addEventListener:function(a,b){return this._listeners[a]===undefined&&(this._listeners[a]=[]),this._listeners[a].push(b),this},dispatchEvent:function(a){a.target=this;var b="on"+a.type;this[b]&&this[b](a);var c=this._listeners[a.type];if(c)for(var d=0,e=c.length;d<e;++d)c[d].call(this,a)},hasEventListener:function(a){},removeEventListener:function(a,b){return this},clearEventListener:function(a){return this._listeners[a]=[],this}})}(),tm.input=tm.input||{},function(){tm.input.Keyboard=tm.createClass({element:null,key:null,press:null,down:null,up:null,last:null,init:function(a){this.element=a||document,this.key={},this.press={},this.down={},this.up={},this.last={};var b=this;this.element.addEventListener("keydown",function(a){b.key[a.keyCode]=!0}),this.element.addEventListener("keyup",function(a){b.key[a.keyCode]=!1}),this.element.addEventListener("keypress",function(a){})},run:function(a){var b=this;a=a||30,tm.setLoop(function(){b.update()},1e3/a)},update:function(){for(var a in this.key)this.last[a]=this.press[a],this.press[a]=this.key[a],this.down[a]=(this.press[a]^this.last[a])&this.press[a],this.up[a]=(this.press[a]^this.last[a])&this.last[a];return this},getKey:function(a){return typeof a=="string"&&(a=tm.keyCode[a]),this.press[a]==1},getKeyDown:function(a){return typeof a=="string"&&(a=tm.keyCode[a]),this.down[a]==1},getKeyUp:function(a){return typeof a=="string"&&(a=tm.keyCode[a]),this.up[a]==1},getKeyAngle:function(){var b=null,c=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return c!=0&&a.hasOwnProperty(c)&&(b=a[c]),b}});var a={1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0}}(),tm.input=tm.input||{},function(){tm.input.Mouse=tm.createClass({element:null,init:function(a){this.element=a||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0);var b=this;this.element.addEventListener("mousemove",function(a){b._mousemove(a)}),this.element.addEventListener("mousedown",function(a){b.button|=1<<a.button}),this.element.addEventListener("mouseup",function(a){b.button&=~(1<<a.button)})},run:function(a){var b=this;return a=a||30,tm.setLoop(function(){b.update()},1e3/a),this},update:function(){this.last=this.press,this.press=this.button,this.down=(this.press^this.last)&this.press,this.up=(this.press^this.last)&this.last,this.deltaPosition.setObject(this.position).sub(this.prevPosition),this.prevPosition.setObject(this.position)},getButton:function(b){return typeof b=="string"&&(b=a[b]),(this.press&b)!=0},getButtonDown:function(b){return typeof b=="string"&&(b=a[b]),(this.down&b)!=0},getButtonUp:function(b){return typeof b=="string"&&(b=a[b]),(this.up&b)!=0},_mousemove:function(a){var b=a.target.getBoundingClientRect();this.x=a.clientX-b.left,this.y=a.clientY-b.top},_mousemoveNormal:function(a){var b=a.target.getBoundingClientRect();this.x=a.clientX-b.left,this.y=a.clientY-b.top},_mousemoveScale:function(a){var b=a.target.getBoundingClientRect();this.x=a.clientX-b.left,this.y=a.clientY-b.top,a.target.style.width&&(this.x*=a.target.width/parseInt(a.target.style.width)),a.target.style.height&&(this.y*=a.target.height/parseInt(a.target.style.height))}}),tm.input.Mouse.BUTTON_LEFT=1,tm.input.Mouse.BUTTON_MIDDLE=2,tm.input.Mouse.BUTTON_RIGHT=4;var a={left:tm.input.Mouse.BUTTON_LEFT,middle:tm.input.Mouse.BUTTON_MIDDLE,right:tm.input.Mouse.BUTTON_RIGHT};tm.input.Mouse.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.input.Mouse.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.input.Mouse.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(a){this.deltaPosition.x=a}}),tm.input.Mouse.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(a){this.deltaPosition.y=a}}),tm.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},tm.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},tm.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),tm.input=tm.input||{},function(){tm.input.Touch=tm.createClass({element:null,touched:!1,init:function(a){this.element=a||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0);var b=this;this.element.addEventListener("touchstart",function(a){b._touchmove(a),b.touched=!0}),this.element.addEventListener("touchend",function(a){b.touched=!1}),this.element.addEventListener("touchmove",function(a){b._touchmove(a),a.stop()})},run:function(a){var b=this;return a=a||30,tm.setLoop(function(){b.update()},1e3/a),this},update:function(){this.last=this.now,this.now=this.touched,this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.setObject(this.position).sub(this.prevPosition),this.prevPosition.setObject(this.position)},getTouch:function(){return this.touched!=0},getTouchStart:function(){return this.start!=0},getTouchEnd:function(){return this.end!=0},_touchmove:function(a){var b=a.touches[0];this.x=b.pageX,this.y=b.pageY},_touchmoveScale:function(a){var b=a.touches[0];this.x=b.pageX,this.y=b.pageY,a.target.style.width&&(this.x*=a.target.width/parseInt(a.target.style.width)),a.target.style.height&&(this.y*=a.target.height/parseInt(a.target.style.height))}}),tm.input.Touch.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.input.Touch.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.input.Touch.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(a){this.deltaPosition.x=a}}),tm.input.Touch.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(a){this.deltaPosition.y=a}}),tm.input.Touch.prototype.getPointing=tm.input.Touch.prototype.getTouch,tm.input.Touch.prototype.getPointingStart=tm.input.Touch.prototype.getTouchStart,tm.input.Touch.prototype.getPointingEnd=tm.input.Touch.prototype.getTouchEnd}(),tm.input=tm.input||{},function(){tm.input.Accelerometer=tm.createClass({init:function(a){this.gravity=tm.geom.Vector3(0,0,0),this.acceleration=tm.geom.Vector3(0,0,0),this.orientation=tm.geom.Vector3(0,0,0);var b=this;window.addEventListener("devicemotion",function(a){var c=b.acceleration,d=b.gravity;c.x=a.acceleration.x,c.y=a.acceleration.y,c.z=a.acceleration.z,d.x=a.accelerationIncludingGravity.x,d.y=a.accelerationIncludingGravity.y,d.z=a.accelerationIncludingGravity.z}),window.addEventListener("deviceorientation",function(a){var c=b.orientation;c.alpha=a.alpha,c.beta=a.beta,c.gamma=a.gamma})}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Color=tm.createClass({r:255,g:255,b:255,a:1,init:function(a,b,c,d){this.canvas=canvas||document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},toCSSValue:function(){return"rgba({r},{g},{b},{a})".format(this)}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas=tm.createClass({element:null,canvas:null,context:null,init:function(a){this.canvas=null,typeof a=="string"?this.canvas=document.querySelector(a):this.canvas=a||document.createElement("canvas"),this.element=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},resize:function(a,b){return this.canvas.width=a,this.canvas.height=b,this},resizeWindow:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},resizeToFitScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},fitWindow:function(a){a=a||!0;var b=function(){var a=this.element,b=a.style;b.position="absolute",b.left="0px",b.top="0px";var c=a.width/window.innerWidth,d=a.height/window.innerHeight,e=a.height/a.width;c>d?(b.width=innerWidth+"px",b.height=innerWidth*e+"px"):(b.width=innerHeight/e+"px",b.height=innerHeight+"px")}.bind(this);b(),a&&window.addEventListener("resize",b,!1)},clear:function(a,b,c,d){return a=a||0,b=b||0,c=c||this.width,d=d||this.height,this.context.clearRect(a,b,c,d),this},clearColor:function(a,b,c,d,e){return b=b||0,c=c||0,d=d||this.width,e=e||this.height,this.save(),this.resetTransform(),this.fillStyle=a,this.context.fillRect(b,c,d,e),this.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(a,b){return this.context.moveTo(a,b),this},lineTo:function(a,b){return this.context.lineTo(a,b),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(a,b){return this.strokeRect(a,b,1,1)},line:function(a,b,c,d){return this.moveTo(a,b).lineTo(c,d)},drawLine:function(a,b,c,d){return this.beginPath().line(a,b,c,d).stroke()},drawDashLine:function(a,b,c,d,e){var f=null;typeof e=="string"?f=e:(e=e||61680,f=e.toString(2)),f=f.padding(16,"1");var g=c-a,h=d-b,i=Math.sqrt(g*g+h*h);g/=i,h/=i;var j=a,k=b;for(var l=0;l<i;++l)f[l%16]=="1"&&this.drawPoint(j,k),j+=g,k+=h;return this},drawArrow:function(a,b,c,d,e){var f=c-a,g=d-b,h=Math.atan2(g,f)*180/Math.PI;return this.drawLine(a,b,c,d),this.fillPolygon(c,d,e||5,3,h),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var a=1,b=arguments.length/2;a<b;++a)this.lineTo(arguments[a*2],arguments[a*2+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(a,b,c,d){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(a,b,c,d,e){var f=a+e,g=a+c-e,h=b+e,i=b+d-e;return this.context.arc(f,h,e,-Math.PI,-Math.PI*.5,!1),this.context.arc(g,h,e,-Math.PI*.5,0,!1),this.context.arc(g,i,e,0,Math.PI*.5,!1),this.context.arc(f,i,e,Math.PI*.5,Math.PI,!1),this.closePath(),this},fillRoundRect:function(a,b,c,d,e){return this.beginPath().roundRect(a,b,c,d,e).fill()},strokeRoundRect:function(a,b,c,d,e){return this.beginPath().roundRect(a,b,c,d,e).stroke()},polygon:function(a,b,c,d,e){var f=Math.PI*2/d,g=e!=undefined?e*Math.PI/180:-Math.PI/2;this.moveTo(a+Math.cos(g)*c,b+Math.sin(g)*c);for(var h=1;h<d;++h){var i=f*h+g;this.lineTo(a+Math.cos(i)*c,b+Math.sin(i)*c)}return this.closePath(),this},fillPolygon:function(a,b,c,d,e){return this.beginPath().polygon(a,b,c,d,e).fill()},strokePolygon:function(a,b,c,d,e){return this.beginPath().polygon(a,b,c,d,e).stroke()},star:function(a,b,c,d,e,f){var g=c*(e||.38),h=f?f*Math.PI/180:-Math.PI/2,i=Math.PI*2/d/2;this.moveTo(a+Math.cos(h)*c,b+Math.sin(h)*c);for(var j=1;j<d*2;++j){var k=i*j+h,l=j%2?g:c;this.lineTo(a+Math.cos(k)*l,b+Math.sin(k)*l)}return this.closePath(),this},fillStar:function(a,b,c,d,e,f){return this.beginPath().star(a,b,c,d,e,f).fill()},strokeStar:function(a,b,c,d,e,f){return this.beginPath().star(a,b,c,d,e,f).stroke()},circle:function(a,b,c){return this.context.arc(a,b,c,0,Math.PI*2,!1),this},fillCircle:function(a,b,c){var d=this.context;return d.beginPath(),d.arc(a,b,c,0,Math.PI*2,!1),d.closePath(),d.fill(),this},strokeCircle:function(a,b,c){return this.beginPath().circle(a,b,c).stroke()},arc:function(a,b,c,d,e,f){return this.context.arc(a,b,c,d,e,f),this},fillArc:function(a,b,c,d,e,f){return this.beginPath().arc(a,b,c,d,e,f).fill()},strokeArc:function(a,b,c,d,e,f){return this.beginPath().arc(a,b,c,d,e,f).stroke()},triangle:function(a,b,c,d,e,f){return this.moveTo(a,b).lineTo(c,d).lineTo(e,f),this.closePath(),this},fillTriangle:function(a,b,c,d,e,f){return this.beginPath().triangle(a,b,c,d,e,f).fill()},strokeTriangle:function(a,b,c,d,e,f){return this.beginPath().triangle(a,b,c,d,e,f).stroke()},fillText:function(a,b,c){return this.context.fillText.apply(this.context,arguments)},strokeText:function(a,b,c){return this.context.strokeText.apply(this.context,arguments)},fillTextList:function(a,b,c,d,e){d=d||0,e=e||20;for(var f=0,g=a.length;f<g;++f)this.fillText(a[f],b+d*f,c+e*f);return this},strokeTextList:function(a,b,c,d,e){d=d||0,e=e||20;for(var f=0,g=a.length;f<g;++f)this.strokeText(b+d*f,c+e*f,a[f]);return this},drawImage:function(a,b,c){this.context.drawImage.apply(this.context,arguments);return},drawTexture:function(a,b,c){arguments[0]=a.element,this.context.drawImage.apply(this.context,arguments);return},drawBitmap:function(a,b,c){arguments[0]=a.imageData,this.context.putImageData.apply(this.context,arguments);return},setTransform:function(a,b,c,d,e,f){return this.context.setTransform(a,b,c,d,e,f),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},setTransformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},transform:function(a,b,c,d,e,f){return this.context.transform(a,b,c,d,e,f),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},translate:function(a,b){return this.context.translate(a,b),this},rotate:function(a){return this.context.rotate(a),this},scale:function(a,b){return this.context.scale(a,b),this},saveAsImage:function(a){a=a||tm.graphics.Canvas.MIME_TYPE_PNG;var b=this.canvas.toDataURL(a);window.open(b,"save")},setCompositing:function(a,b){},setFillStyle:function(a){return this.context.fillStyle=a,this},setStrokeStyle:function(a){return this.context.strokeStyle=a,this},setColorStyle:function(a,b){return b=b||a,this.context.strokeStyle=a,this.context.fillStyle=b,this},setText:function(a,b,c){var d=this.context;d.font=a,d.textAlign=b,d.textBaseline=c},setLineStyle:function(width,cap,join,miter){with(this.context)lineWidth=width||1,lineCap=cap||"round",lineJoin=join||"round",miterLimit=miter||10;return this},setShadow:function(a,b,c,d){var e=this.context;return e.shadowColor=a||"black",e.shadowOffsetX=b||0,e.shadowOffsetY=c||0,e.shadowBlur=d||0,this},getElement:function(){return this.element}}),tm.graphics.Canvas.MIME_TYPE_PNG="image/png",tm.graphics.Canvas.MIME_TYPE_JPG="image/jpeg",tm.graphics.Canvas.MIME_TYPE_SVG="image/svg+xml",tm.graphics.Canvas.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}}),tm.graphics.Canvas.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a}}),tm.graphics.Canvas.prototype.accessor("fillStyle",{get:function(){return this.context.fillStyle},set:function(a){this.context.fillStyle=a}}),tm.graphics.Canvas.prototype.accessor("strokeStyle",{get:function(){return this.context.strokeStyle},set:function(a){this.context.strokeStyle=a}}),tm.graphics.Canvas.prototype.accessor("globalAlpha",{get:function(){return this.context.globalAlpha},set:function(a){this.context.globalAlpha=a}}),tm.graphics.Canvas.prototype.accessor("globalCompositeOperation",{get:function(){return this.context.globalCompositeOperation},set:function(a){this.context.globalCompositeOperation=a}}),tm.graphics.Canvas.prototype.accessor("shadowBlur",{get:function(){return this.context.shadowBlur},set:function(a){this.context.shadowBlur=a}}),tm.graphics.Canvas.prototype.accessor("shadowColor",{get:function(){return this.context.shadowColor},set:function(a){this.context.shadowColor=a}}),tm.graphics.Canvas.prototype.accessor("lineCap",{get:function(){return this.context.lineCap},set:function(a){this.context.lineCap=a}}),tm.graphics.Canvas.prototype.accessor("lineJoin",{get:function(){return this.context.lineJoin},set:function(a){this.context.lineJoin=a}}),tm.graphics.Canvas.prototype.accessor("miterLimit",{get:function(){return this.context.miterLimit},set:function(a){this.context.miterLimit=a}}),tm.graphics.Canvas.prototype.accessor("lineWidth",{get:function(){return this.context.lineWidth},set:function(a){this.context.lineWidth=a}}),tm.graphics.Canvas.prototype.accessor("font",{get:function(){return this.context.font},set:function(a){this.context.font=a}}),tm.graphics.Canvas.prototype.accessor("textAlign",{get:function(){return this.context.textAlign},set:function(a){this.context.textAlign=a}}),tm.graphics.Canvas.prototype.accessor("textBaseline",{get:function(){return this.context.textBaseline},set:function(a){this.context.textBaseline=a}}),tm.graphics.Canvas.prototype.getter("centerX",function(){return this.canvas.width/2}),tm.graphics.Canvas.prototype.getter("centerY",function(){return this.canvas.height/2})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Texture=tm.createClass({element:null,loaded:!1,init:function(a){this.element=new Image,this.element.src=a;var b=this;this.element.onload=function(){b.loaded=!0}},getElement:function(){return this.element}}),tm.graphics.Texture.prototype.getter("width",function(){return this.element.width}),tm.graphics.Texture.prototype.getter("height",function(){return this.element.height})}(),function(){tm.graphics.TextureManager={textures:{},loaded:!0},tm.graphics.TextureManager.add=function(a,b){b===undefined&&(b=a),this.textures[a]=tm.graphics.Texture(b),this.loaded=!1},tm.graphics.TextureManager.get=function(a){return this.textures[a]},tm.graphics.TextureManager.isLoaded=function(){for(var a in this.textures)if(this.textures[a].loaded==0)return!1;return!0},tm.addLoadCheckList(tm.graphics.TextureManager)}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Bitmap=tm.createClass({imageData:null,init:function(a){if(arguments.length==1)this.imageData=a,this.data=a.data;else if(arguments.length==2){var c=arguments[0],d=arguments[1];this.imageData=b.createImageData(c,d),this.data=this.imageData.data}},getPixelIndex:function(a){var b=a*4;return[this.data[b+0],this.data[b+1],this.data[b+2],this.data[b+3]]},getPixelXY:function(a,b){return this.getPixelIndex(this.posToIndex(a,b))},getPixel:function(a,b){return this.getPixelIndex(this.posToIndex(a,b))},getPixelAsNumber:function(a){var b=a*4;return this.data[b+3]<<24|this.data[b+0]<<16|this.data[b+1]<<8|this.data[b+2]},getPixelAsObject:function(a){var b=a*4;return{r:this.data[b+0],g:this.data[b+1],b:this.data[b+2],a:this.data[b+3]}},getPixelAsArray:function(a){var b=a*4;return[this.data[b+0],this.data[b+1],this.data[b+2],this.data[b+3]]},getPixelAverage:function(a,b,c,d){var e=[0,0,0,0],f=a,g=a+c,h=b,i=b+d;f<0&&(f=0),g>this.width&&(g=this.width),h<0&&(h=0),i>this.height&&(i=this.height);var j=[],k=this.width;for(var l=h;l<i;++l)for(var m=f;m<g;++m){var n=k*l+m;j.push(this.getPixelIndex(n))}var o=o=j.length;for(var l=0;l<o;++l)e[0]+=j[l][0],e[1]+=j[l][1],e[2]+=j[l][2],e[3]+=j[l][3];return e[0]/=o,e[1]/=o,e[2]/=o,e[3]/=o,e},setPixelIndex:function(a,b,c,d){var e=a*4;return this.data[e+0]=b,this.data[e+1]=c,this.data[e+2]=d,this},setPixelXY:function(a,b,c,d,e){return this.setPixelIndex(b*this.imageData.width+a,c,d,e)},setPixel:function(a,b,c,d){return this.setPixelIndex(y*this.imageData.width+x,b,c,d)},setPixel32Index:function(a,b,c,d,e){var f=a*4;return this.data[f+0]=b,this.data[f+1]=c,this.data[f+2]=d,this.data[f+3]=e,this},setPixel32:function(a,b,c,d,e,f){return this.setPixel32Index(b*this.width+a,c,d,e,f)},setPixel32XY:function(a,b,c,d,e,f){return this.setPixel32Index(b*this.width+a,c,d,e,f)},setPixelFromArray:function(a,b){return this.setPixel(a,b[0],b[1],b[2])},setPixel32FromArray:function(a,b){return this.setPixel32(a,b[0],b[1],b[2],b[3])},setPixelFromNumber:function(a,b){return this.setPixel(a,(b&16711680)>>>16,(b&65280)>>>8,(b&255)>>>0)},setPixel32FromNumber:function(a,b){return this.setPixel32(a,(b&16711680)>>>16,(b&65280)>>>8,(b&255)>>>0,(b&4278190080)>>>24)},setPixelFromObject:function(a,b){return this.setPixel(b.r,b.g,b.b)},setPixel32FromObject:function(a,b){return this.setPixel32(b.r,b.g,b.b,b.a)},setPixelFromString:function(a,b){},posToIndex:function(a,b){return b*this.imageData.width+a},filter:function(a){for(var b=0;b<this.height;++b)for(var c=0;c<this.width;++c){var d=this.posToIndex(c,b),e=this.getPixel(d);a.calc(e,d,c,b,this)}return this},noise:function(a,b){a=a||0,b=b||255,range=b-a;for(var c=0,d=this.length;c<d;++c){var e=this.getPixelIndex(c);e[0]=Math.random()*range+a,e[1]=Math.random()*range+a,e[2]=Math.random()*range+a,e[3]=255,this.setPixel32Index(c,e[0],e[1],e[2],e[3])}},applyFilter:function(a){}}),tm.graphics.Bitmap.prototype.accessor("width",{get:function(){return this.imageData.width},set:function(a){this.iamgeData.width=a}}),tm.graphics.Bitmap.prototype.accessor("height",{get:function(){return this.imageData.height},set:function(a){this.iamgeData.height=a}}),tm.graphics.Bitmap.prototype.getter("length",function(){return this.imageData.width*this.imageData.height}),tm.graphics.Canvas.prototype.getBitmap=function(a,b,c,d){return tm.graphics.Bitmap(this.context.getImageData(a||0,b||0,c||this.width,d||this.height))},tm.graphics.Canvas.prototype.createBitmap=function(a,b){return tm.graphics.Bitmap(this.context.createImageData(a||this.width,b||this.height))};var a=document.createElement("canvas"),b=a.getContext("2d")}(),tm.graphics=tm.graphics||{},function(){tm.graphics.MonochromeFilter=tm.createClass({init:function(){},apply:function(a,b){var c=a.length;for(var d=0;d<c;++d){var e=a.getPixelIndex(d),f=e[0]*.3+e[1]*.59+e[2]*.11;b.setPixel32Index(d,f,f,f,255)}return b}})}(),function(){tm.graphics.ReverseFilter=tm.createClass({init:function(){},apply:function(a,b){for(var c=0,d=a.width*a.height;c<d;++c){var e=a.getPixelIndex(c);e[0]=255-e[0],e[1]=255-e[1],e[2]=255-e[2],b.setPixel32Index(c,e[0],e[1],e[2],255)}return b}})}(),function(){tm.graphics.BlurFilter=tm.createClass({init:function(a,b,c){this.blurX=a||4,this.blurY=b||4,this.quality=c||1},apply:function(a,b){var c=Math.floor(this.blurX/2),d=Math.floor(this.blurY/2),e=this.blurX,f=this.blurY,g=a.width,h=a.height,i=a.length,j=function(a,b){for(var h=0;h<i;++h){var j=h%g,k=Math.floor(h/g),l=a.getPixelAverage(j-c,k-d,e,f);b.setPixel32Index(h,l[0],l[1],l[2],255)}},k=a;for(var l=0;l<this.quality;++l)a=k,k=tm.graphics.Bitmap(g,h),j(a,k);return b.imageData=k.imageData,b}})}(),function(){var a=[];for(var b=0;b<255;++b){var c=0;b<100?c=60:b<150?c=150:b<180?c=180:c=220,a[b]=c}tm.graphics.ToonFilter=tm.createClass({toonTable:null,init:function(b){this.toonTable=b||a},apply:function(a,b){for(var c=0,d=a.width*a.height;c<d;++c){var e=a.getPixelIndex(c),f=this.toonTable[e[0]],g=this.toonTable[e[1]],h=this.toonTable[e[2]];b.setPixel32Index(c,f,g,h,255)}return b}})}(),function(){tm.graphics.ColorMatrixFilter=tm.createClass({init:function(a){this.colorMatrix=a},apply:function(a,b){var c=this.colorMatrix;for(var d=0,e=a.length;d<e;++d){var f=a.getPixelIndex(d),g=f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]*c[3]+c[4],h=f[0]*c[5]+f[1]*c[6]+f[2]*c[7]+f[3]*c[8]+c[9],i=f[0]*c[10]+f[1]*c[11]+f[2]*c[12]+f[3]*c[13]+c[14],j=f[0]*c[15]+f[1]*c[16]+f[2]*c[17]+f[3]*c[18]+c[19];b.setPixel32Index(d,g,h,i,j)}return b}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas.prototype.setGradient=function(a){this.context.fillStyle=a.gradient}}(),function(){tm.graphics.LinearGradient=tm.createClass({init:function(a,c,d,e){this.gradient=b.createLinearGradient(a,c,d,e)},addColorStop:function(a,b){return this.gradient.addColorStop(a,b),this},addColorStopList:function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].offset,e=a[b].color;this.addColorStop(d,e)}return this},toStyle:function(){return this.gradient}});var a=document.createElement("canvas"),b=a.getContext("2d")}(),function(){tm.graphics.RadialGradient=tm.createClass({init:function(a,c,d,e,f,g){this.gradient=b.createRadialGradient(a,c,d,e,f,g)},addColorStop:function(a,b){return this.gradient.addColorStop(a,b),this},addColorStopList:function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].offset,e=a[b].color;this.addColorStop(d,e)}return this},toStyle:function(){return this.gradient}});var a=document.createElement("canvas"),b=a.getContext("2d")}(),tm.anim=tm.anim||{},function(){tm.anim.Tween=tm.createClass({superClass:tm.event.EventDispatcher,target:null,time:null,prop:null,now:null,begin:null,finish:null,duration:null,isLooping:null,isPlaying:null,func:Math.linear,fps:30,init:function(a,b,c,d,e,f){this.superInit(),arguments.length==1?this.setObject(a):this.set.apply(this,arguments),this.time=0,this.isPlaying=!1},set:function(a,b,c,d,e,f){this.target=a,this.prop=b,this.begin=c,this.finish=d,this.duration=e,this.change=this.finish-this.begin,this.setTransition(f)},setObject:function(a){for(var b in a)this[b]=a[b];this.change=this.finish-this.begin,this.setTransition(this.func)},setTransition:function(a){return typeof a=="function"?this.func=a:typeof a=="string"?this.func=tm.anim.easing[a]:this.func=tm.anim.easing["default"],this},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("resume",this.time,this.now))},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("start",this.time,this.now))},stop:function(){this.isPlaying=!1,this.dispatchEvent(tm.event.TweenEvent("stop",this.time,this.now))},rewind:function(){this.time=0,this.update()},fforward:function(){this.time=this.duration,this.update()},yoyo:function(){var a=this.finish;this.finish=this.begin,this.begin=a,this.change=this.finish-this.begin,this.start()},update:function(){this.now=this.func(this.time,this.begin,this.change,this.duration),this.target[this.prop]=this.now,this.dispatchEvent(tm.event.TweenEvent("change",this.time,this.now))},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_startTime:function(){this.startTime=(new Date).getTime()},_updateTime:function(){this.isPlaying&&(this._setTime((new Date).getTime()-this.startTime),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_setTime:function(a){var b=a;b>this.duration?this.isLooping?(this.rewind(),this.update(),this.dispatchEvent(tm.event.TweenEvent("loop",this.time,this.now))):(this.time=this.duration,this.update(),this.stop(),this.dispatchEvent(tm.event.TweenEvent("finish",this.time,this.now))):(this.time=b,this.update())}})}(),function(){tm.anim.easing={"default":function(a,b,c,d){return c*a/d+b},linear:function(a,b,c,d){return c*a/d+b},swing:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},easeInOutCubic:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeOutInCubic:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutCubic(a*2,b,c/2,d):tm.anim.easing.easeInCubic(a*2-d,b+c/2,c/2,d)},easeInQuart:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutQuart:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeOutInQuart:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutQuart(a*2,b,c/2,d):tm.anim.easing.easeInQuart(a*2-d,b+c/2,c/2,d)},easeInQuint:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},easeOutQuint:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},easeOutInQuint:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutQuint(a*2,b,c/2,d):tm.anim.easing.easeInQuint(a*2-d,b+c/2,c/2,d)},easeInSine:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOutSine:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeOutInSine:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutSine(a*2,b,c/2,d):tm.anim.easing.easeInSine(a*2-d,b+c/2,c/2,d)},easeInExpo:function(a,b,c,d){return a==0?b:c*Math.pow(2,10*(a/d-1))+b-c*.001},easeOutExpo:function(a,b,c,d){return a==d?b+c:c*1.001*(-Math.pow(2,-10*a/d)+1)+b},easeInOutExpo:function(a,b,c,d){return a==0?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b-c*5e-4:c/2*1.0005*(-Math.pow(2,-10*--a)+2)+b},easeOutInExpo:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutExpo(a*2,b,c/2,d):tm.anim.easing.easeInExpo(a*2-d,b+c/2,c/2,d)},easeInCirc:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeOutCirc:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},easeInOutCirc:function(a,b,c,d){return(a/=d/2)<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeOutInCirc:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutCirc(a*2,b,c/2,d):tm.anim.easing.easeInCirc(a*2-d,b+c/2,c/2,d)},easeInElastic:function(a,b,c,d,e,f){var g;return a==0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b)},easeOutElastic:function(a,b,c,d,e,f){var g;return a==0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},easeInOutElastic:function(a,b,c,d,e,f){var g;return a==0?b:(a/=d/2)==2?b+c:(f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b)},easeOutInElastic:function(a,b,c,d,e,f){return a<d/2?tm.anim.easing.easeOutElastic(a*2,b,c/2,d,e,f):tm.anim.easing.easeInElastic(a*2-d,b+c/2,c/2,d,e,f)},easeInBack:function(a,b,c,d,e){return e==undefined&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},easeOutBack:function(a,b,c,d,e){return e==undefined&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeInOutBack:function(a,b,c,d,e){return e==undefined&&(e=1.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},easeOutInBack:function(a,b,c,d,e){return a<d/2?tm.anim.easing.easeOutBack(a*2,b,c/2,d,e):tm.anim.easing.easeInBack(a*2-d,b+c/2,c/2,d,e)},easeInBounce:function(a,b,c,d){return c-tm.anim.easing.easeOutBounce(d-a,0,c,d)+b},easeOutBounce:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},easeInOutBounce:function(a,b,c,d){return a<d/2?tm.anim.easing.easeInBounce(a*2,0,c,d)*.5+b:tm.anim.easing.easeOutBounce(a*2-d,0,c,d)*.5+c*.5+b},easeOutInBounce:function(a,b,c,d){return a<d/2?tm.anim.easing.easeOutBounce(a*2,b,c/2,d):tm.anim.easing.easeInBounce(a*2-d,b+c/2,c/2,d)}}}(),tm.app=tm.app||{},function(){tm.app.Element=tm.createClass({superClass:tm.event.EventDispatcher,parent:null,children:null,init:function(){this.superInit(),this.children=[],this._listeners={}},remove:function(){return console.assert(this.parent),this.parent.removeChild(this),this},addChild:function(a){return a.parent&&a.remove(),a.parent=this,this.children.push(a),a},addChildTo:function(a){return a.addChild(this),this},addChildren:function(a){var b=a.slice();for(var c=beginIndex,d=b.length;c<d;++c)this.addChild(b[c])},getChildAt:function(){},removeChild:function(a){var b=this.children.indexOf(a);b!=-1&&this.children.splice(b,1)},removeChildren:function(a){a=a||0;var b=this.children.slice();for(var c=a,d=b.length;c<d;++c)b[c].remove();this.children=[]},getChildByName:function(a){for(var b=0,c=this.children.length;b<c;++b)if(this.children[b].name==a)return this.children[b];return null},execChildren:function(a,b){b=b&&b.length?b:[b];var c=this.children.slice();for(var d=0,e=c.length;d<e;++d)a.apply(c[d],b)},getParent:function(){return this.parent},getRoot:function(){if(!this.parent)return null;var a=null;for(a=this.parent;a.parent!=null;a=a.parent);return a}})}(),tm.app=tm.app||{},function(){tm.app.CanvasElement=tm.createClass({superClass:tm.app.Element,position:null,rotation:0,scale:null,_width:64,_height:64,originX:.5,originY:.5,isUpdate:!0,visible:!0,fillStyle:"white",strokeStyle:"white",alpha:1,blendMode:"source-over",shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0,shadowshadowBlur:0,_matrix:null,init:function(){this.superInit(),this.position=tm.geom.Vector2(0,0),this.scale=tm.geom.Vector2(1,1),this.pointing=tm.geom.Vector2(0,0),this._matrix=tm.geom.Matrix33(),this._matrix.identity(),this.eventFlags={}},update:function(){},draw:function(a){},drawBoundingCircle:function(a){a.save(),a.lineWidth=2,a.strokeCircle(0,0,this.radius),a.restore()},drawBoundingRect:function(a){a.save(),a.lineWidth=2,a.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),a.restore()},getFinalMatrix:function(){var a=tm.geom.Matrix33();return this.parent&&a.multiply(this.parent.getFinalMatrix()),a.translate(this.x,this.y),a.rotateZ(this.rotation*Math.DEG_TO_RAD),a.scale(this.scaleX,this.scaleY),a},isHitPoint:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));return this.pointing.x=c.x,this.pointing.y=c.y,c.x*c.x+c.y*c.y<this.radius*this.radius?!0:!1},isHitPointRect:function(a,b){var c=this.parent?this.parent.localToGlobal(this):this,d=c.x-this.width*this.originX,e=c.x+this.width*this.originX,f=c.y-this.height*this.originY,g=c.y+this.height*this.originY;return d<a&&a<e&&f<b&&b<g?!0:!1},isHitPointCircleHierarchy:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));return this.pointing.x=c.x,this.pointing.y=c.y,c.x*c.x+c.y*c.y<this.radius*this.radius?!0:!1},isHitPointRectHierarchy:function(a,b){var c=this.globalToLocal(tm.geom.Vector2(a,b));this.pointing.x=c.x,this.pointing.y=c.y;var d=-this.width*this.originX,e=+this.width*this.originX,f=-this.height*this.originY,g=+this.height*this.originY;return d<c.x&&c.x<e&&f<c.y&&c.y<g?!0:!1},isHitElement:function(a){var b=this.parent.localToGlobal(this);return(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<(this.radius+a.radius)*(this.radius+a.radius)?!0:!1},localToGlobal:function(a){return this.getFinalMatrix().multiplyVector2(a)},globalToLocal:function(a){var b=this.getFinalMatrix();return b.invert(),b.multiplyVector2(a)},drawFillRect:function(a){return a.fillRect(-this.width/2,-this.height/2,this.width,this.height),this},drawStrokeRect:function(a){return a.strokeRect(-this.width/2,-this.height/2,this.width,this.height),this},drawFillArc:function(a){return a.beginPath(),a.arc(0,0,this.radius,0,Math.PI*2,!1),a.fill(),a.closePath(),this},drawStrokeArc:function(a){return a.beginPath(),a.arc(0,0,this.radius,0,Math.PI*2,!1),a.stroke(),a.closePath(),this},wakeUp:function(){return this.isUpdate=!0,this},sleep:function(){return this.isUpdate=!1,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},setX:function(a){return this.position.x=a,this},setY:function(a){return this.position.y=a,this},setPosition:function(a,b){return this.position.x=a,this.position.y=b,this},setWidth:function(a){return this.width=a,this},setHeight:function(a){return this.height=a,this},setSize:function(a,b){return this.width=a,this.height=b,this},setFillStyle:function(a){return this.fillStyle=a,this},setStrokeStyle:function(a){return this.strokeStyle=a,this},fromJSON:function(a){for(var b in a){var c=a[b];if(b=="children")for(var d=0,e=c.length;d<e;++d){var a=c[d],f=window[a.type]||tm.app[a.type],g=f().addChildTo(this);g.fromJSON(a),this[a.name]=g}else this[b]=c}return this},toJSON:function(){},_update:function(a){if(this.isUpdate==0)return;this.update(a);var b=tm.event.Event("enterframe");b.app=a,this.dispatchEvent(b);if(this.children.length>0){var c=this.children.slice();for(var d=0,e=c.length;d<e;++d)c[d]._update(a)}},_draw:function(a){if(this.visible===!1)return;var b=a.context;b.save(),b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.globalAlpha*=this.alpha,b.globalCompositeOperation=this.blendMode,this.shadowBlur>0&&(b.shadowColor=this.shadowColor,b.shadowOffsetX=this.shadowOffsetX,b.shadowOffsetY=this.shadowOffsetY,b.shadowBlur=this.shadowBlur),b.translate(this.position.x,this.position.y),b.rotate(this.rotation*Math.DEG_TO_RAD),b.scale(this.scale.x,this.scale.y),this.draw(a);if(this.children.length>0){var c=this.children.slice();for(var d=0,e=c.length;d<e;++d)c[d]._draw(a)}b.restore()},_checkEvent:function(a,b){a(this)===!0?(this.eventFlags[b]=!0,this[b]&&this[b]()):this.eventFlags[b]=!1;for(var c=0;c<this.children.length;++c)this.children[c]._checkEvent(a,b)},_refreshSize:function(){}}),tm.app.CanvasElement.prototype.accessor("x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),tm.app.CanvasElement.prototype.accessor("y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),tm.app.CanvasElement.prototype.accessor("scaleX",{get:function(){return this.scale.x},set:function(a){this.scale.x=a}}),tm.app.CanvasElement.prototype.accessor("scaleY",{get:function(){return this.scale.y},set:function(a){this.scale.y=a}}),tm.app.CanvasElement.prototype.accessor("width",{get:function(){return this._width},set:function(a){this._width=a,this._refreshSize()}}),tm.app.CanvasElement.prototype.accessor("height",{get:function(){return this._height},set:function(a){this._height=a,this._refreshSize()}}),tm.app.CanvasElement.prototype.accessor("radius",{get:function(){return this._radius||(this.width+this.height)/4},set:function(a){this._radius=a}}),tm.app.CanvasElement.prototype.getter("top",function(){return this.y-this.height*this.originY}),tm.app.CanvasElement.prototype.getter("right",function(){return this.x+this.width*this.originX}),tm.app.CanvasElement.prototype.getter("bottom",function(){return this.y+this.height*this.originY}),tm.app.CanvasElement.prototype.getter("left",function(){return this.x-this.width*this.originX})}(),tm.app=tm.app||{},function(){tm.app.Sprite=tm.createClass({superClass:tm.app.CanvasElement,init:function(a,b,c){this.superInit(),a=a||64,b=b||64,this.srcRect=tm.geom.Rect(0,0,this.width,this.height),this.width=a,this.height=b,c&&(this.image=c)},draw:function(a){var b=this.srcRect,c=this._image.element;a.drawImage(c,b.x,b.y,b.width,b.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)},setFrameIndex:function(a,b,c){var d=b||this.width,e=b||this.height,f=~~(this.image.width/d),g=a%f,h=~~(a/f);this.srcRect.x=g*d,this.srcRect.y=h*e,this.srcRect.width=d,this.srcRect.height=e},_refreshSize:function(){}}),tm.app.Sprite.prototype.accessor("image",{get:function(){return this._image},set:function(a){typeof texture=="string"&&(texture=tm.graphics.TextureManager.get(texture)),this._image=a,this.srcRect.x=0,this.srcRect.y=0,this.srcRect.width=a.element.width,this.srcRect.height=a.element.height}})}(),tm.app=tm.app||{},function(){tm.app.Shape=tm.createClass({superClass:tm.app.CanvasElement,init:function(a,b){this.superInit(),a=a||64,b=b||64,this.canvas=tm.graphics.Canvas(),this.width=a,this.height=b,this.canvas.resize(a,b)},draw:function(a){var b=this.srcRect;return a.drawImage(this.canvas.canvas,0,0,this.width,this.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height),this},renderer:function(a){}}),tm.app.Shape.prototype.accessor("shapeParam",{get:function(){return this._shapeParam},set:function(a){a.extendSafe(this.selfClass.DEFAULT_SHAPE_PARAM),this._shapeParam=a,this.renderer(a)}})}(),function(){tm.app.CircleShape=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){this.superInit(a,b),this.shapeParam=c||{}},renderer:function(a){var b=this.canvas;b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth,b.fillCircle(this.width/2,this.height/2,this.radius),b.strokeCircle(this.width/2,this.height/2,this.radius-Number(b.lineWidth)/2),b.restore()}}),tm.app.CircleShape.DEFAULT_SHAPE_PARAM={fillStyle:"red",strokeStyle:"white",lineWidth:"4"}}(),function(){tm.app.TriangleShape=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){this.superInit(a,b),this.shapeParam=c||{}},renderer:function(a){var b=this.canvas;b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth,b.fillPolygon(this.width/2,this.height/2,this.radius,3),b.strokePolygon(this.width/2,this.height/2,this.radius-Number(b.lineWidth)/2,3),b.restore()}}),tm.app.TriangleShape.DEFAULT_SHAPE_PARAM={fillStyle:"green",strokeStyle:"white",lineWidth:"4"}}(),function(){tm.app.RectangleShape=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){this.superInit(a,b),this.shapeParam=c||{}},renderer:function(a){var b=this.canvas;b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth;var c=Number(b.lineWidth),d=c/2;b.fillRect(0,0,this.width,this.height),b.strokeRect(d,d,this.width-c,this.height-c),b.restore()}}),tm.app.RectangleShape.DEFAULT_SHAPE_PARAM={fillStyle:"blue",strokeStyle:"white",lineWidth:"4"}}(),function(){tm.app.StarShape=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){this.superInit(a,b),this.shapeParam=c||{}},renderer:function(a){var b=this.canvas;b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth;var c=Number(b.lineWidth),d=c/2,e=a.sides,f=a.sideIndent,g=a.offsetAngle;b.fillStar(this.width/2,this.height/2,this.radius,e,f,g),b.strokeStar(this.width/2,this.height/2,this.radius-Number(b.lineWidth)/2,e,f,g),b.restore()}}),tm.app.StarShape.DEFAULT_SHAPE_PARAM={fillStyle:"yellow",strokeStyle:"white",lineWidth:"4",sides:5,sideIndent:undefined,offsetAngle:undefined}}(),function(){tm.app.PolygonShape=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){this.superInit(a,b),this.shapeParam=c||{}},renderer:function(a){var b=this.canvas;b.save(),b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.lineWidth;var c=Number(b.lineWidth),d=c/2,e=a.sides,f=a.sideIndent,g=a.offsetAngle;b.fillPolygon(this.width/2,this.height/2,this.radius,e,g),b.strokePolygon(this.width/2,this.height/2,this.radius-Number(b.lineWidth)/2,e,g),b.restore()}}),tm.app.PolygonShape.DEFAULT_SHAPE_PARAM={fillStyle:"cyan",strokeStyle:"white",lineWidth:"4",sides:5,offsetAngle:undefined}}(),tm.app=tm.app||{},function(){tm.app.Label=tm.createClass({superClass:tm.app.CanvasElement,fill:!0,stroke:!1,debugBox:!1,init:function(a,b){this.superInit(),this.text=a||"HOGE",this.fontSize=b||24,this.fontFamily="'Consolas', 'Monaco', 'ＭＳ ゴシック'",this.align="start",this.baseline="alphabetic"},draw:function(a){a.setText(this.fontStyle,this.align,this.baseline),this.fill&&a.fillText(this.text,0,0,this.width),this.stroke&&a.strokeText(this.text,0,0,this.width),this.debugBox&&a.strokeRect(0,0,this.width,-this.size)},setAlign:function(a){return this.align=a,this},setBaseline:function(a){return this.baseline=a,this},setFontSize:function(a){return this.fontSize=a,this},setFontFamily:function(a){return this.fontFamily=a,this},_updateFont:function(){this.fontStyle="{fontSize}px {fontFamily}".format(this)}}),tm.app.Label.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(a){this._fontSize=a,this._updateFont()}}),tm.app.Label.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(a){this._fontFamily=a,this._updateFont()}})}(),tm.app=tm.app||{},function(){tm.app.LabelButton=tm.createClass({superClass:tm.app.Label,init:function(a){this.superInit(a),this.alpha=tm.app.LabelButton.DEFAULT_ALPHA,this.setAlign("center").setBaseline("middle"),this.interaction.enabled=!0,this.interaction.boundingType="rect",this.addEventListener("pointingover",function(){this.animation.fade(1,250)}),this.addEventListener("pointingout",function(){this.animation.fade(tm.app.LabelButton.DEFAULT_ALPHA,250)})}}),tm.app.LabelButton.DEFAULT_ALPHA=.5}(),function(){tm.app.IconButton=tm.createClass({superClass:tm.app.Sprite,init:function(a){a?this.superInit(a.width,a.height,a):this.superInit(),this.alpha=tm.app.IconButton.DEFAULT_ALPHA,this.interaction.enabled=!0,this.interaction.boundingType="rect",this.addEventListener("pointingover",function(){this.animation.fade(1,250)}),this.addEventListener("pointingout",function(){this.animation.fade(tm.app.IconButton.DEFAULT_ALPHA,250)})}}),tm.app.IconButton.DEFAULT_ALPHA=.5}(),function(){tm.app.iPhoneButton=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c,d){this.superInit(a,b),d=d||"Button",this.backgroundColor=c||"black",this.alpha=tm.app.iPhoneButton.DEFAULT_ALPHA,this.interaction.enabled=!0,this.interaction.boundingType="rect",this.addEventListener("pointingover",function(){this.animation.fade(1,250)}),this.addEventListener("pointingout",function(){this.animation.fade(tm.app.iPhoneButton.DEFAULT_ALPHA,250)}),this.label=tm.app.Label(d||"").addChildTo(this),this.label.setAlign("center").setBaseline("middle"),this._refresh()},setBackgroundColor:function(a){return this.backgroundColor=a,this._refresh(),this},_refresh:function(){var a=this.canvas;a.resize(this.width,this.height),a.fillStyle=this.backgroundColor,a.fillRoundRect(2,2,this.width-4,this.height-4,10),a.strokeStyle="rgba(100,100,100,0.75)",a.lineWidth=2,a.strokeRoundRect(2,2,this.width-4,this.height-4,10),a.roundRect(2,2,this.width-4,this.height-4,10),a.clip();var b=tm.graphics.LinearGradient(0,0,0,this.height);b.addColorStop(0,"rgba(255,255,255,0.9)"),b.addColorStop(.5,"rgba(255,255,255,0.5)"),b.addColorStop(.51,"rgba(255,255,255,0.2)"),b.addColorStop(1,"rgba(255,255,255,0.0)"),a.setGradient(b),a.fillRect(2,2,this.width-4,this.height-4,10),this.label.setSize(this.width,this.height)}}),tm.app.iPhoneButton.DEFAULT_ALPHA=.5}(),tm.app=tm.app||{},function(){tm.app.Scene=tm.createClass({superClass:tm.app.CanvasElement,init:function(){this.superInit(),this.interaction.enabled=!0,this.interaction.boundingType="none"}}),tm.app.StartScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit()},onenter:function(a){var b=tm.app.Label("Start");b.x=a.app.canvas.width/2,b.y=a.app.canvas.height/2,b.width=a.app.canvas.width,b.align="center",b.baseline="middle",this.addChild(b),this.width=a.app.canvas.width,this.height=a.app.canvas.height,this.app=a.app}}),tm.app.EndScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit()},onenter:function(a){var b=tm.app.Label("end");b.x=a.app.canvas.width/2,b.y=a.app.canvas.height/2,b.width=a.app.canvas.width,b.align="center",b.baseline="middle",this.addChild(b),this.width=a.app.canvas.width,this.height=a.app.canvas.height,this.app=a.app}})}(),tm.app=tm.app||{},function(){tm.app.CanvasApp=tm.createClass({element:null,canvas:null,mouse:null,touch:null,pointing:null,keyboard:null,stats:null,frame:0,fps:30,background:null,isPlaying:null,_scenes:null,_sceneIndex:0,init:function(a){a instanceof HTMLCanvasElement?this.element=a:typeof a=="string"?this.element=document.querySelector(a):(this.element=document.createElement("canvas"),document.body.appendChild(this.element)),this.canvas=tm.graphics.Canvas(this.element),this.mouse=tm.input.Mouse(this.element),this.touch=tm.input.Touch(this.element),this.keyboard=tm.input.Keyboard(),this.pointing=tm.isMobile?this.touch:this.mouse,this.accelerometer=tm.input.Accelerometer(),this.isPlaying=!0,this.background="black",this._scenes=[tm.app.Scene()],this._sceneIndex=0,this.element.addEventListener("touchstart",function(a){a.stop()}),window.addEventListener("focus",function(){this.currentScene.dispatchEvent(tm.event.Event("focus"))}.bind(this)),window.addEventListener("blur",function(){this.currentScene.dispatchEvent(tm.event.Event("blur"))}.bind(this))},resize:function(a,b){return this.width=a,this.height=b,this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this},fitWindow:function(a){this.canvas.fitWindow(a),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale},run:function(){var a=this;tm.setLoop(function(){a._loop()},1e3/this.fps);return;var a},_loop:function(){this.update&&this.update(),this._update(),this.draw&&this.draw(),this._draw(),this.stats&&this.stats.update()},replaceScene:function(a){var b=null;this.currentScene&&(b=tm.event.Event("exit"),b.app=this,this.currentScene.dispatchEvent(b)),b=tm.event.Event("enter"),b.app=this,this.currentScene=a,this.currentScene.dispatchEvent(b)},pushScene:function(a){e=tm.event.Event("exit"),e.app=this,this.currentScene.dispatchEvent(e),this._scenes.push(a),++this._sceneIndex,e=tm.event.Event("enter"),e.app=this,a.dispatchEvent(e)},popScene:function(){var a=this._scenes.pop(a);return--this._sceneIndex,e=tm.event.Event("exit"),e.app=this,a.dispatchEvent(e),e=tm.event.Event("enter"),e.app=this,this.currentScene.dispatchEvent(e),a},enableStats:function(){window.Stats?(this.stats=new Stats,this.stats.domElement.style.position="fixed",this.stats.domElement.style.left="5px",this.stats.domElement.style.top="5px",document.body.appendChild(this.stats.domElement)):console.warn("not defined stats.")},enableDatGUI:function(){if(window.dat){var a=new dat.GUI;return a}},start:function(){this.isPlaying=!0},stop:function(){this.isPlaying=!1},_update:function(){this.mouse.update(),this.keyboard.update(),this.touch.update(),this.isPlaying&&(this.currentScene._update(this),++this.frame)},_draw:function(){this.canvas.clearColor(this.background,0,0),this.canvas.fillStyle="white",this.canvas.strokeStyle="white";for(var a=0,b=this._scenes.length;a<b;++a)this._scenes[a]._draw(this.canvas)},getElement:function(){return this.element}}),tm.app.CanvasApp.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}}),tm.app.CanvasApp.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a}}),tm.app.CanvasApp.prototype.accessor("currentScene",{get:function(){return this._scenes[this._sceneIndex]},set:function(a){this._scenes[this._sceneIndex]=a}})}(),tm.app=tm.app||{},function(){tm.app.Interaction=tm.createClass({hitFlag:!1,downFlag:!1,enabled:!0,hitTestFunc:null,_boundingType:"circle",init:function(a){this.element=a,this.setBoundingType("circle")},update:function(a){if(this.enabled===!1)return;var b=this.element,c=a.pointing,d=this.hitFlag;this.hitFlag=this.hitTestFunc.call(b,c.x,c.y),!d&&this.hitFlag&&(b.dispatchEvent(tm.event.MouseEvent("mouseover",a)),b.dispatchEvent(tm.event.TouchEvent("touchover",a)),b.dispatchEvent(tm.event.PointingEvent("pointingover",a))),d&&!this.hitFlag&&(b.dispatchEvent(tm.event.MouseEvent("mouseout",a)),b.dispatchEvent(tm.event.TouchEvent("touchout",a)),b.dispatchEvent(tm.event.PointingEvent("pointingout",a))),this.hitFlag&&c.getPointingStart()&&(b.dispatchEvent(tm.event.MouseEvent("mousedown",a)),b.dispatchEvent(tm.event.TouchEvent("touchstart",a)),b.dispatchEvent(tm.event.PointingEvent("pointingstart",a)),this.downFlag=!0),this.downFlag&&(b.dispatchEvent(tm.event.MouseEvent("mousemove",a)),b.dispatchEvent(tm.event.TouchEvent("touchmove",a)),b.dispatchEvent(tm.event.PointingEvent("pointingmove",a))),this.downFlag==1&&c.getPointingEnd()&&(b.dispatchEvent(tm.event.MouseEvent("mouseup",a)),b.dispatchEvent(tm.event.TouchEvent("touchend",a)),b.dispatchEvent(tm.event.PointingEvent("pointingend",a)),this.downFlag=!1)},setBoundingType:function(a){this.boundingType=a},_setHitTestFunc:function(){return this.boundingType=="rect"?this.hitTestFunc=tm.app.CanvasElement.prototype.isHitPointRectHierarchy:this.boundingType=="circle"?this.hitTestFunc=tm.app.CanvasElement.prototype.isHitPointCircleHierarchy:this.hitTestFunc=function(){return!0},this}}),tm.app.Interaction.prototype.accessor("boundingType",{get:function(){return this._boundingType},set:function(a){this._boundingType=a,this._setHitTestFunc()}}),tm.app.Element.prototype.getter("interaction",function(){return this._interaction||(this._interaction=tm.app.Interaction(this),this.addEventListener("enterframe",function(a){this._interaction.update(a.app)})),this._interaction})}(),tm.app=tm.app||{},function(){tm.app.Collision=tm.createClass({collideList:null,init:function(a){this.element=a,this.collideList=[]},update:function(a){var b=this.collideList.clone(),c=this.element;for(var d=0,e=b.length;d<e;++d){var f=b[d];if(c.isHitElement(f.element)){if(f.collide===!1){var g=tm.event.Event("collisionenter");g.other=f.element,c.dispatchEvent(g)}var g=tm.event.Event("collisionstay");g.other=f.element,c.dispatchEvent(g),f.collide=!0}else{if(f.collide==1){var g=tm.event.Event("collisionexit");g.other=f.element,c.dispatchEvent(g)}f.collide=!1}}},add:function(a){this.collideList.push({element:a,collide:!1})},remove:function(a){this.collideList.eraseIf(function(b){return b.element==a})}}),tm.app.Element.prototype.getter("collision",function(){return this._collision||(this._collision=tm.app.Collision(this),this.addEventListener("enterframe",function(a){this._collision.update(a.app)})),this._collision})}(),tm.app=tm.app||{},function(){tm.app.Animation=tm.createClass({isAnimation:!1,init:function(a){this.element=a,this.tweens=[]},update:function(a){var b=this.tweens.clone();for(var c=0,d=b.length;c<d;++c){var e=b[c];if(e.delay>0){e.delay-=1e3/a.fps;continue}var f=e.time+1e3/a.fps;e._setTime(f);if(e.time>=e.duration){this.tweens.erase(e);if(this.tweens.length<=0){this.isAnimation=!1;var g=tm.event.Event("animationend");this.element.dispatchEvent(g)}}else e.update()}},addTween:function(a){a.target||(a.target=this.element);var b=tm.anim.Tween(a);b.delay=a.delay||0,this.tweens.push(b);if(this.isAnimation==0){this.isAnimation=!0;var c=tm.event.Event("animationstart");this.element.dispatchEvent(c)}return b},addTweens:function(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];this.addTween(d)}return this},fade:function(a,b){return b=b!==undefined?b:1e3,this.addTween({prop:"alpha",begin:this.element.alpha,finish:a,duration:b}),this},move:function(a,b,c,d){return c=c!==undefined?c:1e3,d=d||"linear",this.addTween({prop:"x",begin:this.element.x,finish:this.element.x+a,duration:c,func:d}),this.addTween({prop:"y",begin:this.element.y,finish:this.element.y+b,duration:c,func:d}),this},moveTo:function(a,b,c,d){return c=c!==undefined?c:1e3,d=d||"linear",this.addTween({prop:"x",begin:this.element.x,finish:a,duration:c,func:d}),this.addTween({prop:"y",begin:this.element.y,finish:b,duration:c,func:d}),this},scale:function(a,b){return b=b!==undefined?b:1e3,this.addTween({prop:"scaleX",begin:this.element.scaleX,finish:a,duration:b}),this.addTween({prop:"scaleY",begin:this.element.scaleY,finish:a,duration:b}),this},fadeIn:function(a){return this.fade(1,a)},fadeOut:function(a){return this.fade(0,a)},clear:function(){return this.tweens=[],this}}),tm.app.Element.prototype.getter("animation",function(){return this._animation||(this._animation=tm.app.Animation(this),this.addEventListener("enterframe",function(a){this._animation.update(a.app)})),this._animation})}(),tm.sound=tm.sound||{},function(){tm.sound.globalVolume=1}(),function(){tm.sound.Sound=tm.createClass({element:null,loaded:!1,isPlay:!1,init:function(a){this.element=new Audio,this.element.src=a,this.element.load(),this.element.setAttribute("preload","auto");var b=this;this.element.addEventListener("canplaythrough",function(){b.loaded=!0}),this.element.addEventListener("ended",function(){b.isPlay=!1}),this.element.addEventListener("error",function(){console.warn(this.src+"の読み込みに失敗しました")}),this.element.volume=1,tm.isMobile&&(this.loaded=!0)},play:function(){return this.element.play(),this.isPlay=!0,this},stop:function(){return this.element.pause(),tm.isMobile||(this.element.currentTime=0),this.isPlay=!1,this},pause:function(){return this.element.pause(),this},clone:function(){return TM.App.Sound(this.element.src)}}),tm.sound.Sound.prototype.accessor("volume",{get:function(){return this.element.volume},set:function(a){this.element.volume=a}});if((new Audio).loop!==undefined)tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(a){this.element.loop=a}});else{var a=function(){this.play()};tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(b){this.element.loop!=1&&b==1?this.element.addEventListener("ended",a,!1):this.element.loop==1&&b==0&&this.element.removeEventListener("ended",a,!1),this.element.loop=b}})}tm.sound.Sound.SUPPORT_EXT=function(){var a="",b=new Audio;return b.canPlayType("audio/wav")=="maybe"?a="wav":b.canPlayType("audio/mp3")=="maybe"?a="mp3":b.canPlayType("audio/ogg")=="maybe"&&(a="ogg"),a}()}(),function(){var a=tm.isMobile?1:4;tm.sound.SoundManager={sounds:{}},tm.sound.SoundManager.add=function(b,c,d){d=d||a,c.split("/").at(-1).indexOf(".")==-1&&(c+="."+tm.sound.Sound.SUPPORT_EXT);var e=this.sounds[b]=[];for(var f=0;f<d;++f){var g=tm.sound.Sound(c);e.push(g)}return this},tm.sound.SoundManager.get=function(a){var b=this.sounds[a];for(var c=0,d=b.length;c<d;++c)if(b[c].isPlay==0)return b[c];return b[0]},tm.sound.SoundManager.getByIndex=function(a,b){return this.sounds[a][b]},tm.sound.SoundManager.remove=function(a){return this},tm.sound.SoundManager.setVolume=function(a,b){return this},tm.sound.SoundManager.isLoaded=function(){for(var a in this.sounds){var b=this.sounds[a];for(var c=0,d=b.length;c<d;++c)if(b[c].loaded==0)return!1}return!0},tm.addLoadCheckList(tm.sound.SoundManager)}(),tm.social=tm.social||{},function(){tm.social.Twitter=tm.social.Twitter||{};var a="http://twitter.com/intent";tm.social.Twitter.createURL=function(b){var c=[];for(var d in b){if(d=="type")continue;var e=encodeURIComponent(b[d]),f=d+"="+e;c.push(f)}var g="{baseURL}/{type}?{param}".format({baseURL:a,type:b.type,param:c.join("&")});return g}}(),tm.social=tm.social||{},function(){tm.social.Nineleap=tm.social.Nineleap||{};var a="http://9leap.net/games/{id}/result?score={score}&result={result}";tm.social.Nineleap.createURL=function(b,c,d){return a.format({id:b,score:c,result:d})},tm.social.Nineleap.postRanking=function(a,b){if(location.hostname=="r.jsgames.jp"){var c=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(this.createURL(c,a,b))}else console.warn("9leap に投稿されていません!")}}(),tm.google=tm.google||{},function(){tm.google.Chart=tm.google.Chart||{};var a="https://chart.googleapis.com/chart?chst={type}&chld={data}",b="https://chart.googleapis.com/chart?chs={size}&cht={type}&chl={text}&chco={color}";tm.google.Chart.createDynamicIcons=function(b,c){return a.format({type:b,data:c})},tm.google.Chart.createQRCode=function(a,c,d){return c=encodeURIComponent(c),b.format({type:"qr",size:a,text:c})},tm.google.Chart.createTeX=function(){}}()